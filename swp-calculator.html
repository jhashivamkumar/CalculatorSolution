<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>SWP Calculator (Systematic Withdrawal Plan) + Year-wise Table | CalculatorSolution</title>
  <meta name="description" content="Free SWP Calculator: enter investment amount, expected return, withdrawal amount and duration to estimate total withdrawals, closing balance and a year-wise SWP schedule.">

  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://calculatorsolution.com/swp-calculator.html">

  <meta property="og:title" content="SWP Calculator">
  <meta property="og:description" content="Calculate SWP withdrawals, projected balance and schedule for your investments.">
  <meta property="og:image" content="https://calculatorsolution.com/assets/og-image.svg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://calculatorsolution.com/assets/og-image.svg">

  <link rel="icon" href="/assets/og-image.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/assets/logo.png">
  <link rel="manifest" href="/assets/site.webmanifest">

  <!-- Global CSS -->
  <link rel="preload" href="/assets/style.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/style.css"></noscript>

  <!-- ‚úÖ UI/UX + Responsive improvements (NO logic changes) -->
  <style>
    :root{
      --r-8: 8px;
      --r-12: 12px;
      --r-16: 16px;
      --r-18: 18px;
      --r-24: 24px;
      --shadow-1: 0 1px 3px rgba(0,0,0,0.04);
      --shadow-2: 0 10px 24px rgba(8,13,26,.05);
      --shadow-3: 0 18px 50px rgba(2,6,23,.15);
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --muted2:#475569;
      --bgCard: rgba(255,255,255,.92);
      --focus: rgba(59,130,246,.12);
    }

    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial;
      background:radial-gradient(1200px 700px at 10% 10%, rgba(59,130,246,.14), transparent 60%),
                 radial-gradient(900px 600px at 90% 20%, rgba(168,85,247,.14), transparent 55%),
                 linear-gradient(135deg,#f8fafc,#f1f5f9);
      color:var(--text);
      line-height:1.6;
      min-height:100vh;
      -webkit-text-size-adjust:100%;
      text-rendering:optimizeLegibility;
    }

    *{box-sizing:border-box}
    img{max-width:100%;height:auto}
    a{color:inherit}
    ::selection{background:rgba(59,130,246,.18)}

    /* Container */
    .wrap{max-width:1100px;margin:0 auto;padding:0 18px}
    @media (max-width:420px){.wrap{padding:0 14px}}

    /* Header */
    .site-header{
      padding:14px 0;border-bottom:1px solid var(--border);
      background:rgba(255,255,255,.65);backdrop-filter:blur(10px);
      position:sticky;top:0;z-index:10
    }
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    .brand-text{font-weight:900;color:#2563eb;font-size:1.15rem;white-space:nowrap}
    .brand-logo{border-radius:10px}

    /* Hero */
    .hero{
      margin:18px 0 14px 0;border-radius:18px;padding:26px 18px;
      color:#fff;background:linear-gradient(135deg,#2563eb,#a855f7);
      box-shadow:var(--shadow-3);
      position:relative;overflow:hidden;
    }
    .hero:before{
      content:""; position:absolute; inset:-60px -60px auto auto;
      width:240px;height:240px;border-radius:999px;
      background:rgba(255,255,255,.16);
      transform:rotate(10deg);
      pointer-events:none;
    }
    .hero h1{margin:0 0 6px 0;font-size:1.85rem;letter-spacing:-.02em}
    .hero p{margin:0;opacity:.95;max-width:70ch}
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.18);
      font-weight:800;font-size:.88rem;
    }

    /* Layout */
    .calc-shell{
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,.9fr);
      gap:14px;
      align-items:start;
      margin-top:14px
    }

    .panel{
      background:var(--bgCard);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 14px 40px rgba(8,13,26,.06);
      padding:14px;
      overflow:hidden; /* prevents long content overflow on small widths */
    }

    .panel-title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px
    }
    .panel-title h2{margin:0;font-size:1.05rem;line-height:1.3}

    .pill{
      display:inline-flex;gap:8px;align-items:center;
      padding:6px 10px;border-radius:999px;
      background:rgba(37,99,235,.10);
      color:#1d4ed8;
      font-weight:900;
      font-size:.85rem;
      white-space:nowrap;
      flex:0 0 auto;
    }

    /* Inputs grid (responsive, no HTML changes) */
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .field{display:flex;flex-direction:column;gap:6px;min-width:0}
    .field label{font-weight:900;font-size:.92rem}
    .input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:1rem;
      background:#fff;
      outline:none;
      min-height:44px; /* better mobile tap target */
    }
    select.input{appearance:none;background-image:linear-gradient(45deg,transparent 50%,#64748b 50%),linear-gradient(135deg,#64748b 50%,transparent 50%);background-position:calc(100% - 18px) 50%,calc(100% - 12px) 50%;background-size:6px 6px,6px 6px;background-repeat:no-repeat;padding-right:36px}
    .input:focus{border-color:#93c5fd;box-shadow:0 0 0 4px var(--focus)}
    .help{margin:0;font-size:.86rem;color:var(--muted);line-height:1.4}
    .mini{font-size:.86rem;color:var(--muted)}
    pre{overflow:auto;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.7);padding:12px}

    /* Buttons */
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:12px;
      font-weight:900;
      border:0;
      cursor:pointer;
      background:linear-gradient(90deg,#2563eb,#60a5fa);
      color:#fff;
      box-shadow:0 12px 26px rgba(37,99,235,.18);
      transition:transform .2s, box-shadow .2s;
      min-height:44px;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 16px 34px rgba(37,99,235,.22)}
    .btn:active{transform:translateY(0)}
    .btn:focus-visible{outline:0;box-shadow:0 0 0 4px var(--focus), 0 16px 34px rgba(37,99,235,.22)}
    .btn-ghost{background:#fff;color:var(--text);border:1px solid var(--border);box-shadow:none}
    .btn-dark{background:#0f172a;box-shadow:0 14px 30px rgba(2,6,23,.18)}
    .btn-dark:focus-visible{box-shadow:0 0 0 4px rgba(15,23,42,.20), 0 14px 30px rgba(2,6,23,.18)}

    /* Sticky results (desktop) */
    .sticky{position:sticky;top:82px}

    /* Metrics */
    .metric{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background:linear-gradient(180deg, rgba(37,99,235,.10), rgba(255,255,255,.92));
      margin-bottom:10px;
    }
    .metric.alt{
      background:linear-gradient(180deg, rgba(168,85,247,.10), rgba(255,255,255,.92));
    }
    .metric .k{margin:0;color:var(--muted2);font-size:.86rem;font-weight:800}
    .metric .v{
      margin:4px 0 0;
      font-size:1.55rem;
      font-weight:1000;
      letter-spacing:-.02em;
      line-height:1.15;
      word-break:break-word;
    }

    .bar{
      height:10px;border-radius:999px;background:var(--border);overflow:hidden;margin-top:10px
    }
    .bar > span{display:block;height:100%;width:0%}

    /* Table */
    .table-wrap{
      overflow:auto;
      border:1px solid var(--border);
      border-radius:16px;
      background:#fff;
      box-shadow:0 12px 26px rgba(8,13,26,.05);
      -webkit-overflow-scrolling:touch;
    }
    table{width:100%;border-collapse:collapse;min-width:920px}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left;font-size:.95rem;white-space:nowrap}
    th{background:#f8fafc;font-weight:1000;position:sticky;top:0;z-index:1}
    tr:last-child td{border-bottom:0}

    /* Note */
    .note{
      border:1px dashed #cbd5e1;
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.7);
      margin-top:10px
    }

    /* FAQ cards */
    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow:var(--shadow-2);
      padding:12px
    }
    details.card{padding:0;overflow:hidden}
    details.card summary{
      cursor:pointer;
      padding:12px;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    details.card summary::-webkit-details-marker{display:none}
    details.card summary:after{
      content:"+";
      font-weight:1000;
      color:#334155;
      flex:0 0 auto;
    }
    details[open].card summary:after{content:"‚Äì"}
    details.card p{padding:0 12px 12px;margin:0;color:#334155}

    /* Related section grid safety (even if global css missing) */
    .cards-grid{
      display:grid;
      grid-template-columns:repeat(4,minmax(0,1fr));
      gap:12px;
    }
    .cards-grid a.card h4{margin:0 0 6px;font-size:1rem}
    .cards-grid a.card p{margin:0;color:#475569}

    /* ‚úÖ Responsive breakpoints */
    @media (max-width: 1100px){
      .hero h1{font-size:1.7rem}
      table{min-width:860px}
    }

    @media (max-width: 920px){
      .calc-shell{grid-template-columns:1fr}
      .sticky{position:static}
      table{min-width:760px}
    }

    @media (max-width: 680px){
      .hero{padding:20px 14px;border-radius:16px}
      .hero h1{font-size:1.45rem}
      .grid-2{grid-template-columns:1fr}
      .actions .btn{flex:1 1 140px}
      table{min-width:680px}
      .cards-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }

    @media (max-width: 420px){
      .hero h1{font-size:1.35rem}
      .chip{font-size:.84rem}
      .panel{padding:12px}
      .metric .v{font-size:1.35rem}
      .cards-grid{grid-template-columns:1fr}
    }

    /* ‚úÖ Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto !important;transition:none !important}
      .btn:hover{transform:none}
      .card:hover{transform:none}
    }
  </style>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y5YHCPQPFS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments)}
    gtag('js', new Date());
    gtag('config', 'G-Y5YHCPQPFS');
  </script>

  <!-- Schema: WebPage + Breadcrumb + HowTo + FAQ -->
  <script type="application/ld+json">[
    {
      "@context":"https://schema.org",
      "@type":"WebPage",
      "name":"SWP Calculator",
      "url":"https://calculatorsolution.com/swp-calculator.html",
      "description":"Calculate SWP withdrawals, projected balance and year-wise schedule for your investment."
    },
    {
      "@context":"https://schema.org",
      "@type":"BreadcrumbList",
      "itemListElement":[
        {"@type":"ListItem","position":1,"name":"CalculatorSolution","item":"https://calculatorsolution.com/"},
        {"@type":"ListItem","position":2,"name":"SWP Calculator","item":"https://calculatorsolution.com/swp-calculator.html"}
      ]
    },
    {
      "@context":"https://schema.org",
      "@type":"HowTo",
      "name":"How to use an SWP calculator",
      "step":[
        {"@type":"HowToStep","name":"Enter your investment details","text":"Add starting amount and expected annual return rate."},
        {"@type":"HowToStep","name":"Enter withdrawal details","text":"Choose withdrawal frequency and amount, plus the duration."},
        {"@type":"HowToStep","name":"View results","text":"See total withdrawals, projected closing balance and the year-wise SWP schedule."}
      ]
    },
    {
      "@context":"https://schema.org",
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"Can principal run out?","acceptedAnswer":{"@type":"Answer","text":"Yes. If withdrawals are high or returns are low, the investment can deplete over time."}},
        {"@type":"Question","name":"Tax on withdrawals?","acceptedAnswer":{"@type":"Answer","text":"Tax depends on product type and local rules. SWP from mutual funds may involve capital gains taxation."}},
        {"@type":"Question","name":"Inflation impact?","acceptedAnswer":{"@type":"Answer","text":"Inflation reduces the real value of withdrawals. Consider increasing withdrawal amounts or planning a buffer."}},
        {"@type":"Question","name":"Sequence risk?","acceptedAnswer":{"@type":"Answer","text":"Poor returns early in the withdrawal period can reduce longevity of your corpus."}},
        {"@type":"Question","name":"Should I adjust withdrawals?","acceptedAnswer":{"@type":"Answer","text":"Yes. Reducing withdrawals during weak markets can help preserve capital."}}
      ]
    }
  ]</script>
</head>

<body>
  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="/">
        <img src="/assets/logo.png" alt="CalculatorSolution logo" class="brand-logo" width="36" height="36">
        <span class="brand-text">CalculatorSolution</span>
      </a>
    </div>
  </header>

  <main class="wrap">
    <article>
      <div class="hero">
        <h1>SWP Calculator</h1>
        <p>Project regular withdrawals from an investment and see how long your corpus may last.</p>
        <div class="chips">
          <span class="chip">üè¶ Starting investment</span>
          <span class="chip">üí∏ Withdrawals</span>
          <span class="chip">üìä Schedule</span>
        </div>
      </div>

      <section>
        <div id="premium-swp">
          <div class="calc-shell">

            <!-- Inputs -->
            <div class="panel" aria-label="SWP inputs">
              <div class="panel-title">
                <h2>Investment & withdrawal details</h2>
                <span class="pill">‚úÖ Inputs</span>
              </div>

              <div class="grid-2">
                <div class="field">
                  <label for="swp_principal">Starting investment</label>
                  <input id="swp_principal" class="input" type="number" inputmode="numeric" min="0" step="1000" placeholder="e.g., 1000000">
                  <p class="help">Initial corpus / investment amount.</p>
                </div>

                <div class="field">
                  <label for="swp_return">Expected return (annual)</label>
                  <input id="swp_return" class="input" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g., 10">
                  <p class="help">Example: 10 means 10% per year (assumed constant).</p>
                </div>

                <div class="field">
                  <label for="swp_withdraw">Withdrawal amount</label>
                  <input id="swp_withdraw" class="input" type="number" inputmode="numeric" min="0" step="500" placeholder="e.g., 15000">
                  <p class="help">Amount you plan to withdraw each period.</p>
                </div>

                <div class="field">
                  <label for="swp_freq">Withdrawal frequency</label>
                  <select id="swp_freq" class="input">
                    <option value="12" selected>Monthly</option>
                    <option value="4">Quarterly</option>
                    <option value="2">Half-yearly</option>
                    <option value="1">Yearly</option>
                  </select>
                  <p class="help">Monthly is most common for SWP.</p>
                </div>

                <div class="field">
                  <label for="swp_years">Duration</label>
                  <div style="display:flex;gap:10px;flex-wrap:wrap;">
                    <input id="swp_years" class="input" type="number" inputmode="numeric" min="1" step="1" placeholder="e.g., 10" style="flex:1 1 160px;">
                    <span class="mini" style="align-self:center;">years</span>
                  </div>
                  <p class="help">How long you plan withdrawals.</p>
                </div>

                <div class="field">
                  <label for="swp_increase">Annual increase (optional)</label>
                  <input id="swp_increase" class="input" type="number" inputmode="decimal" min="0" step="0.1" placeholder="e.g., 5">
                  <p class="help">Increase withdrawal by % each year (inflation adjustment).</p>
                </div>

                <div class="field">
                  <label for="swp_round">Round values</label>
                  <select id="swp_round" class="input">
                    <option value="0" selected>No rounding</option>
                    <option value="10">Nearest 10</option>
                    <option value="100">Nearest 100</option>
                  </select>
                  <p class="help">For cleaner numbers in outputs.</p>
                </div>

                <div class="field">
                  <label for="swp_show_years">Show schedule</label>
                  <select id="swp_show_years" class="input">
                    <option value="10" selected>First 10 years</option>
                    <option value="20">First 20 years</option>
                    <option value="50">First 50 years</option>
                  </select>
                  <p class="help">Table is capped for performance.</p>
                </div>
              </div>

              <div class="actions">
                <button class="btn" id="swp_calc_btn" type="button">Calculate</button>
                <button class="btn btn-dark" id="swp_example_btn" type="button">Try Example</button>
                <button class="btn btn-ghost" id="swp_reset_btn" type="button">Reset</button>
              </div>

              <div class="note mini">
                Model: Each period, returns apply to current balance, then withdrawal is deducted.
                Real-world returns fluctuate; this is an estimate using a constant expected return.
              </div>
            </div>

            <!-- Results -->
            <div class="panel sticky" aria-label="SWP results">
              <div class="panel-title">
                <h2>Results</h2>
                <span class="pill">üî• Output</span>
              </div>

              <div class="metric">
                <p class="k">Total withdrawn</p>
                <p class="v" id="swp_out_withdrawn">‚Äî</p>
                <p class="mini" id="swp_out_withdrawn_note">‚Äî</p>
              </div>

              <div class="metric alt">
                <p class="k">Projected closing balance</p>
                <p class="v" id="swp_out_closing">‚Äî</p>
                <p class="mini" id="swp_out_closing_note">‚Äî</p>
              </div>

              <div class="metric">
                <p class="k">Corpus longevity</p>
                <p class="v" id="swp_out_longevity">‚Äî</p>
                <div class="bar"><span id="swp_bar_deplete"></span></div>
                <p class="mini" id="swp_out_longevity_note">‚Äî</p>
              </div>

              <div class="metric alt">
                <p class="k">Summary</p>
                <p class="mini" id="swp_out_summary">Enter details to see a clean summary.</p>
              </div>
            </div>

          </div>

          <h2 style="margin:18px 0 6px;">Year-wise SWP Schedule</h2>
          <p class="mini" style="margin:0 0 10px;">Each row shows opening balance, total withdrawal, interest earned and closing balance for the year.</p>

          <div class="table-wrap">
            <table aria-label="SWP year-wise table">
              <thead>
                <tr>
                  <th>Year</th>
                  <th>Opening Balance</th>
                  <th>Withdrawal (Year)</th>
                  <th>Interest Earned</th>
                  <th>Closing Balance</th>
                </tr>
              </thead>
              <tbody id="swp_table">
                <tr><td colspan="5" class="mini">Click <strong>Calculate</strong> to generate the schedule.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section style="margin-top:18px;">
        <h2>Explanation</h2>
        <p>
          A <strong>Systematic Withdrawal Plan (SWP)</strong> lets you withdraw a fixed amount regularly from an investment corpus
          (often mutual funds). This calculator estimates how withdrawals impact your remaining balance using a constant expected return.
        </p>
        <ul>
          <li><strong>Total withdrawn</strong> over your chosen duration</li>
          <li><strong>Closing balance</strong> (how much may remain after withdrawals)</li>
          <li><strong>Longevity</strong> (whether the corpus may deplete early)</li>
          <li><strong>Year-wise schedule</strong> for easy planning</li>
        </ul>
        <p class="mini">
          Tip: If you want to maintain spending power, use the <strong>annual increase</strong> option to grow withdrawals by inflation.
        </p>
      </section>

      <section>
        <h3>Formula</h3>
        <pre>Period rate = (annual_rate / 100) / periods_per_year
Each period:
  balance = balance √ó (1 + period_rate)
  balance = balance ‚àí withdrawal
Stop if balance ‚â§ 0</pre>
      </section>

      <section class="faqs">
        <h3>FAQs</h3>
        <details class="card"><summary><strong>Can principal run out?</strong></summary><p>Yes. If withdrawals are too high compared to returns, the corpus may deplete before the duration ends.</p></details>
        <details class="card"><summary><strong>Tax on withdrawals?</strong></summary><p>Depends on product type and rules. For mutual funds, taxes may apply on capital gains.</p></details>
        <details class="card"><summary><strong>Inflation?</strong></summary><p>Inflation reduces purchasing power. Consider increasing withdrawals yearly to keep up.</p></details>
        <details class="card"><summary><strong>Sequence risk?</strong></summary><p>If returns are poor early, the corpus can deplete faster. This calculator assumes steady returns.</p></details>
        <details class="card"><summary><strong>Adjustments?</strong></summary><p>Reducing withdrawals during bad markets can help preserve your corpus.</p></details>
      </section>

      <section class="related" style="margin-top:18px;">
        <h3>Related calculators</h3>
        <div class="cards-grid related-grid">
          <a class="card" href="sip-calculator.html"><h4>SIP Calculator</h4><p>Estimate future value of systematic investments.</p></a>
          <a class="card" href="lumpsum-calculator.html"><h4>Lumpsum Calculator</h4><p>Project growth of one-time investment.</p></a>
          <a class="card" href="compound-interest-calculator.html"><h4>Compound Interest Calculator</h4><p>Compute growth with compounding.</p></a>
          <a class="card" href="inflation-calculator.html"><h4>Inflation Calculator</h4><p>Estimate inflation impact on money value.</p></a>
        </div>
      </section>

    </article>
  </main>

  <footer class="site-footer">
    <div class="wrap" style="padding:18px 0;color:#64748b;">
      <p>&copy; CalculatorSolution</p>
      <p style="margin-top:8px;font-size:0.9rem;">
        <a href="/sitemap.xml">Sitemap</a> |
        <a href="/">Home</a> |
        <a href="/privacy-policy.html">Privacy Policy</a> |
        <a href="/terms-of-service.html">Terms</a> |
        <a href="/contact.html">Contact</a> |
        <a href="/about.html">About</a>
      </p>
    </div>
  </footer>

  <!-- ‚úÖ LOGIC unchanged: same JS as you provided -->
  <script>
    (function(){
      const $ = (id)=>document.getElementById(id);

      const fmt0 = (n)=> (isFinite(n) ? new Intl.NumberFormat(undefined,{maximumFractionDigits:0}).format(n) : '‚Äî');
      const money = (n)=> '‚Çπ ' + fmt0(n);

      const pEl = $('swp_principal');
      const rEl = $('swp_return');
      const wEl = $('swp_withdraw');
      const fEl = $('swp_freq');
      const yEl = $('swp_years');
      const incEl = $('swp_increase');
      const roundEl = $('swp_round');
      const showEl = $('swp_show_years');

      const outW = $('swp_out_withdrawn');
      const outWn = $('swp_out_withdrawn_note');
      const outC = $('swp_out_closing');
      const outCn = $('swp_out_closing_note');
      const outL = $('swp_out_longevity');
      const outLn = $('swp_out_longevity_note');
      const outS = $('swp_out_summary');
      const bar = $('swp_bar_deplete');
      const tbody = $('swp_table');

      function roundTo(x, step){
        step = parseInt(step,10) || 0;
        if(!step) return x;
        return Math.round(x/step)*step;
      }

      function calc(){
        const P0 = parseFloat(pEl.value);
        const annual = parseFloat(rEl.value);
        const wd0 = parseFloat(wEl.value);
        const periods = parseInt(fEl.value,10); // 12/4/2/1
        const years = parseInt(yEl.value,10);
        const inc = parseFloat(incEl.value) || 0; // annual increase %
        const roundStep = parseInt(roundEl.value,10) || 0;
        const showYears = parseInt(showEl.value,10) || 10;

        if(!isFinite(P0) || P0<=0){
          outW.textContent='‚Äî'; outWn.textContent='Enter valid starting investment.';
          tbody.innerHTML = '<tr><td colspan="5" class="mini">Enter inputs and click <strong>Calculate</strong>.</td></tr>';
          return;
        }
        if(!isFinite(annual) || annual<0){
          outW.textContent='‚Äî'; outWn.textContent='Enter valid expected return.';
          tbody.innerHTML = '<tr><td colspan="5" class="mini">Enter inputs and click <strong>Calculate</strong>.</td></tr>';
          return;
        }
        if(!isFinite(wd0) || wd0<0){
          outW.textContent='‚Äî'; outWn.textContent='Enter valid withdrawal amount.';
          tbody.innerHTML = '<tr><td colspan="5" class="mini">Enter inputs and click <strong>Calculate</strong>.</td></tr>';
          return;
        }
        if(!isFinite(years) || years<=0){
          outW.textContent='‚Äî'; outWn.textContent='Enter valid duration.';
          tbody.innerHTML = '<tr><td colspan="5" class="mini">Enter inputs and click <strong>Calculate</strong>.</td></tr>';
          return;
        }

        const pr = (annual/100)/periods; // period rate
        let balance = P0;

        let totalWithdrawn = 0;
        let totalInterest = 0;

        const rows = [];
        let depletedAtYear = null;

        for(let yr=1; yr<=years; yr++){
          const opening = balance;

          // apply annual increase at start of each year (year 2+)
          const wdThisYear = wd0 * Math.pow(1 + (inc/100), (yr-1));
          const wdPerPeriod = wdThisYear; // user entered "per period"
          // NOTE: wd0 is per period amount (monthly/quarterly/etc).
          // For schedule, yearly withdrawal = wdPerPeriod * periods.

          let interestYear = 0;
          let withdrawnYear = 0;

          for(let p=1; p<=periods; p++){
            if(balance<=0){
              if(depletedAtYear===null) depletedAtYear = yr;
              break;
            }
            const interest = balance * pr;
            balance += interest;
            interestYear += interest;
            totalInterest += interest;

            const wd = Math.min(balance, wdPerPeriod);
            balance -= wd;
            withdrawnYear += wd;
            totalWithdrawn += wd;

            if(balance<=0){
              if(depletedAtYear===null) depletedAtYear = yr;
              break;
            }
          }

          rows.push({
            year: yr,
            opening,
            withdrawn: withdrawnYear,
            interest: interestYear,
            closing: balance
          });

          if(balance<=0) break;
        }

        // Outputs
        outW.textContent = money(roundTo(totalWithdrawn, roundStep));
        outWn.textContent = `Withdrawal frequency: ${periods===12?'Monthly':periods===4?'Quarterly':periods===2?'Half-yearly':'Yearly'} ‚Ä¢ Duration: ${years} year(s)`;

        outC.textContent = money(roundTo(balance, roundStep));
        outCn.textContent = balance>0 ? 'Projected remaining corpus after withdrawals.' : 'Corpus depleted during the plan.';

        if(depletedAtYear){
          outL.textContent = `${depletedAtYear} yr`;
          outLn.textContent = `Corpus depleted around year ${depletedAtYear}. Consider lowering withdrawals or increasing corpus.`;
          bar.style.width = '100%';
          bar.style.background = 'linear-gradient(90deg, rgba(239,68,68,.95), rgba(168,85,247,.9))';
        } else {
          outL.textContent = `‚â• ${rows.length} yr`;
          outLn.textContent = 'Corpus did not deplete within selected duration.';
          // "Depletion risk" bar: rough ratio withdrawals vs starting corpus
          const risk = (P0>0) ? Math.min(100, (totalWithdrawn / (P0 + 1e-9)) * 100) : 0;
          bar.style.width = risk.toFixed(1) + '%';
          bar.style.background = 'linear-gradient(90deg, rgba(168,85,247,.9), rgba(59,130,246,.9))';
        }

        const perLabel = periods===12?'month':periods===4?'quarter':periods===2?'half-year':'year';
        outS.textContent =
          `Start ‚Çπ${fmt0(P0)} ‚Ä¢ Return ${annual}% ‚Ä¢ Withdraw ‚Çπ${fmt0(wd0)}/${perLabel}` +
          (inc>0 ? ` ‚Ä¢ Annual increase ${inc}%` : '') +
          ` ‚Ä¢ Total withdrawn ‚Çπ${fmt0(totalWithdrawn)} ‚Ä¢ Closing ‚Çπ${fmt0(balance)}.`;

        // Table (cap by showYears)
        const cap = Math.min(showYears, rows.length);
        const html = [];
        for(let i=0; i<cap; i++){
          const r = rows[i];
          html.push(`
            <tr>
              <td>${r.year}</td>
              <td>${money(roundTo(r.opening, roundStep))}</td>
              <td>${money(roundTo(r.withdrawn, roundStep))}</td>
              <td>${money(roundTo(r.interest, roundStep))}</td>
              <td>${money(roundTo(r.closing, roundStep))}</td>
            </tr>
          `);
        }
        if(rows.length > cap){
          html.push(`<tr><td colspan="5" class="mini">Table truncated for readability (showing first ${cap} years). Increase ‚ÄúShow schedule‚Äù to see more.</td></tr>`);
        }
        tbody.innerHTML = html.join('');
      }

      $('swp_calc_btn').addEventListener('click', calc);

      $('swp_example_btn').addEventListener('click', ()=>{
        pEl.value = '1000000';
        rEl.value = '10';
        wEl.value = '15000';
        fEl.value = '12';
        yEl.value = '15';
        incEl.value = '5';
        roundEl.value = '0';
        showEl.value = '20';
        calc();
      });

      $('swp_reset_btn').addEventListener('click', ()=>{
        [pEl,rEl,wEl,yEl,incEl].forEach(el=>el.value='');
        fEl.value='12';
        roundEl.value='0';
        showEl.value='10';

        outW.textContent='‚Äî';
        outWn.textContent='‚Äî';
        outC.textContent='‚Äî';
        outCn.textContent='‚Äî';
        outL.textContent='‚Äî';
        outLn.textContent='‚Äî';
        outS.textContent='Enter details to see a clean summary.';
        bar.style.width='0%';

        tbody.innerHTML = '<tr><td colspan="5" class="mini">Click <strong>Calculate</strong> to generate the schedule.</td></tr>';
      });

      // Auto-calc when user edits (optional)
      [pEl,rEl,wEl,fEl,yEl,incEl,roundEl,showEl].forEach(el=>{
        el.addEventListener('input', ()=>{ if(pEl.value) calc(); });
        el.addEventListener('change', ()=>{ if(pEl.value) calc(); });
      });
    })();
  </script>
</body>
</html>
