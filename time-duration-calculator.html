<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>Time Duration Calculator (HH:MM:SS) | Add/Subtract Time | CalculatorSolution</title>
  <meta name="description" content="Free Time Duration Calculator: find duration between two times (supports crossing midnight) and add/subtract hours, minutes, seconds. Get HH:MM:SS, decimal hours, and total minutes/seconds.">

  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://calculatorsolution.com/time-duration-calculator.html">

  <meta property="og:title" content="Time Duration Calculator">
  <meta property="og:description" content="Calculate duration between times (cross-midnight supported) and add/subtract time intervals. Get HH:MM:SS and decimal hours.">
  <meta property="og:image" content="https://calculatorsolution.com/assets/og-image.svg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://calculatorsolution.com/assets/og-image.svg">

  <link rel="icon" href="/assets/og-image.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/assets/logo.png">
  <link rel="manifest" href="/assets/site.webmanifest">

  <!-- Global CSS -->
  <link rel="preload" href="/assets/style.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/style.css"></noscript>

  <!-- Premium critical CSS (logic untouched; only responsive + UX polish) -->
  <style>
    :root{
      --wrap:1100px;
      --pad:18px;
      --card:#fff;
      --border:#e2e8f0;
      --muted:#64748b;
      --text:#0f172a;
      --focus:rgba(59,130,246,.14);
    }

    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial;
      background:radial-gradient(1200px 700px at 10% 10%, rgba(59,130,246,.14), transparent 60%),
                 radial-gradient(900px 600px at 90% 20%, rgba(168,85,247,.14), transparent 55%),
                 linear-gradient(135deg,#f8fafc,#f1f5f9);
      color:var(--text);
      line-height:1.6;
      min-height:100vh;
      -webkit-text-size-adjust:100%;
      text-rendering:optimizeLegibility;
    }
    *{box-sizing:border-box}
    img{max-width:100%;height:auto}
    a{color:inherit}
    .wrap{max-width:var(--wrap);margin:0 auto;padding:0 var(--pad)}
    .sr-only{position:absolute;left:-9999px}

    /* Header */
    .site-header{
      padding:14px 0;
      border-bottom:1px solid var(--border);
      background:rgba(255,255,255,.72);
      backdrop-filter:blur(10px);
      position:sticky;
      top:0;
      z-index:10;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      min-height:44px; /* touch-friendly */
    }
    .brand-text{font-weight:900;color:#2563eb;font-size:1.15rem}
    .brand-logo{border-radius:10px}

    /* Hero */
    .hero{
      margin:18px 0 14px 0;
      border-radius:18px;
      padding:26px 18px;
      color:#fff;
      background:linear-gradient(135deg,#2563eb,#a855f7);
      box-shadow:0 18px 50px rgba(2,6,23,.15);
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-60px -60px auto auto;
      width:240px;height:240px;border-radius:999px;
      background:rgba(255,255,255,.16);
      transform:rotate(10deg);
      pointer-events:none;
    }
    .hero h1{
      margin:0 0 6px 0;
      font-size:clamp(1.35rem, 2.2vw, 1.95rem);
      letter-spacing:-.02em;
      line-height:1.2;
    }
    .hero p{margin:0;opacity:.95;max-width:70ch}
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.18);
      font-weight:800;font-size:.88rem;
      backdrop-filter:blur(4px);
    }

    /* Layout */
    .calc-shell{
      display:grid;
      grid-template-columns:1.1fr .9fr;
      gap:14px;
      align-items:start;
      margin-top:14px
    }
    .panel{
      background:rgba(255,255,255,.92);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 14px 40px rgba(8,13,26,.06);
      padding:14px;
    }
    .panel-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .panel-title h2{margin:0;font-size:1.05rem}
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(37,99,235,.10);
      color:#1d4ed8;
      font-weight:900;
      font-size:.85rem;
      white-space:nowrap;
    }

    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:flex;flex-direction:column;gap:6px;min-width:0}
    .field label{font-weight:900;font-size:.92rem}
    .input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:1rem;
      background:#fff;
      outline:none;
      min-height:44px; /* touch target */
    }
    .input:focus{border-color:#93c5fd;box-shadow:0 0 0 4px var(--focus)}
    .help{margin:0;font-size:.86rem;color:var(--muted)}
    .field pre, pre{overflow:auto}

    /* Tabs */
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 10px}
    .tab{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      font-weight:900;
      cursor:pointer;
      min-height:44px; /* touch */
      line-height:1;
      transition:transform .15s, background .15s, border-color .15s;
    }
    .tab:hover{transform:translateY(-1px)}
    .tab:focus{outline:none;box-shadow:0 0 0 4px var(--focus)}
    .tab[aria-selected="true"]{
      border-color:#93c5fd;
      background:rgba(37,99,235,.08);
      color:#1d4ed8;
    }

    /* Actions */
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:12px;
      font-weight:900;
      border:0;
      cursor:pointer;
      background:linear-gradient(90deg,#2563eb,#60a5fa);
      color:#fff;
      box-shadow:0 12px 26px rgba(37,99,235,.18);
      transition:transform .2s, box-shadow .2s;
      min-height:44px;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 16px 34px rgba(37,99,235,.22)}
    .btn:active{transform:translateY(0)}
    .btn:focus{outline:none;box-shadow:0 0 0 4px var(--focus), 0 16px 34px rgba(37,99,235,.18)}
    .btn-ghost{background:#fff;color:var(--text);border:1px solid var(--border);box-shadow:none}
    .btn-dark{background:#0f172a;box-shadow:0 14px 30px rgba(2,6,23,.18)}

    /* Sticky results */
    .sticky{position:sticky;top:82px}

    /* Results cards */
    .metric{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background:linear-gradient(180deg, rgba(37,99,235,.10), rgba(255,255,255,.92));
      margin-bottom:10px;
    }
    .metric.alt{
      background:linear-gradient(180deg, rgba(168,85,247,.10), rgba(255,255,255,.92));
    }
    .metric .k{margin:0;color:#475569;font-size:.86rem;font-weight:800}
    .metric .v{
      margin:4px 0 0;
      font-size:clamp(1.25rem, 3vw, 1.55rem);
      font-weight:1000;
      letter-spacing:-.02em;
      word-break:break-word;
    }
    .mini{font-size:.86rem;color:var(--muted)}
    .bar{height:10px;border-radius:999px;background:var(--border);overflow:hidden;margin-top:10px}
    .bar > span{display:block;height:100%;width:0%}

    /* Tables */
    .table-wrap{
      overflow:auto;
      border:1px solid var(--border);
      border-radius:16px;
      background:#fff;
      box-shadow:0 12px 26px rgba(8,13,26,.05)
    }
    table{width:100%;border-collapse:collapse;min-width:760px}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left;font-size:.95rem;vertical-align:top}
    th{background:#f8fafc;font-weight:1000}
    tr:last-child td{border-bottom:0}

    /* FAQ cards */
    .card{background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 24px rgba(8,13,26,.05);padding:12px}
    details.card{padding:0}
    details.card summary{cursor:pointer;padding:12px;list-style:none}
    details.card summary::-webkit-details-marker{display:none}
    details.card summary:focus{outline:none;box-shadow:0 0 0 4px var(--focus);border-radius:14px}
    details.card p{padding:0 12px 12px;margin:0;color:#334155}

    /* Related grid helper (works even if global CSS isn't loaded) */
    .cards-grid{
      display:grid;
      gap:12px;
      grid-template-columns:repeat(4, minmax(0,1fr));
    }
    .cards-grid a.card{display:block;text-decoration:none}
    .cards-grid h4{margin:0 0 6px}
    .cards-grid p{margin:0;color:#334155}

    /* Content spacing */
    article > section{margin-top:18px}
    pre{
      padding:12px;
      background:#0b1220;
      color:#e5e7eb;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.06);
      box-shadow:0 10px 26px rgba(2,6,23,.10);
    }

    /* Responsive: tablets */
    @media (max-width: 1024px){
      .wrap{padding:0 16px}
      .calc-shell{grid-template-columns:1fr;gap:12px}
      .sticky{position:static}
      table{min-width:640px}
      .cards-grid{grid-template-columns:repeat(2, minmax(0,1fr))}
    }

    /* Responsive: phones */
    @media (max-width: 640px){
      .hero{padding:18px 14px;border-radius:16px}
      .grid-2{grid-template-columns:1fr}
      .panel{padding:12px}
      .panel-title{align-items:flex-start}
      .actions{display:grid;grid-template-columns:1fr;gap:10px}
      .btn{width:100%}
      table{min-width:520px}
      .cards-grid{grid-template-columns:1fr}
      th,td{padding:10px}
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto !important}
      .btn,.card,.tab{transition:none !important}
      .btn:hover,.card:hover,.tab:hover{transform:none !important}
    }
  </style>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y5YHCPQPFS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments)}
    gtag('js', new Date());
    gtag('config', 'G-Y5YHCPQPFS');
  </script>

  <!-- Schema: WebPage + Breadcrumb + HowTo + FAQ -->
  <script type="application/ld+json">[
    {
      "@context":"https://schema.org",
      "@type":"WebPage",
      "name":"Time Duration Calculator",
      "url":"https://calculatorsolution.com/time-duration-calculator.html",
      "description":"Calculate duration between two times (cross-midnight supported) and add/subtract time intervals."
    },
    {
      "@context":"https://schema.org",
      "@type":"BreadcrumbList",
      "itemListElement":[
        {"@type":"ListItem","position":1,"name":"CalculatorSolution","item":"https://calculatorsolution.com/"},
        {"@type":"ListItem","position":2,"name":"Time Duration Calculator","item":"https://calculatorsolution.com/time-duration-calculator.html"}
      ]
    },
    {
      "@context":"https://schema.org",
      "@type":"HowTo",
      "name":"How to calculate time duration",
      "step":[
        {"@type":"HowToStep","name":"Pick a mode","text":"Choose Duration (between two times) or Add/Subtract (apply an interval)."},
        {"@type":"HowToStep","name":"Enter your times","text":"Use HH:MM and optional seconds. Enable Cross midnight if end time is next day."},
        {"@type":"HowToStep","name":"Calculate","text":"Get the result in HH:MM:SS plus decimal hours and total minutes/seconds."}
      ]
    },
    {
      "@context":"https://schema.org",
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"Cross midnight?","acceptedAnswer":{"@type":"Answer","text":"If the end time is earlier than the start time, enable cross-midnight to treat the end time as next day."}},
        {"@type":"Question","name":"What format is supported?","acceptedAnswer":{"@type":"Answer","text":"You can enter HH:MM with optional seconds. Outputs include HH:MM:SS, decimal hours, total minutes, and total seconds."}},
        {"@type":"Question","name":"Timezones?","acceptedAnswer":{"@type":"Answer","text":"This calculator uses your local device time representation. For different timezones, convert times to a common timezone before comparing."}},
        {"@type":"Question","name":"Business use?","acceptedAnswer":{"@type":"Answer","text":"Useful for timesheets, shift durations, project tracking, and billing hours."}},
        {"@type":"Question","name":"Precision?","acceptedAnswer":{"@type":"Answer","text":"Seconds-level precision is supported. Milliseconds are not included to keep inputs simple."}}
      ]
    }
  ]</script>
</head>

<body>
  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="/">
        <img src="/assets/logo.png" alt="CalculatorSolution logo" class="brand-logo" width="36" height="36">
        <span class="brand-text">CalculatorSolution</span>
      </a>
    </div>
  </header>

  <main class="wrap">
    <article>
      <div class="hero">
        <h1>Time Duration Calculator</h1>
        <p>Compute duration between two times or add/subtract an interval ‚Äî with cross-midnight support.</p>
        <div class="chips">
          <span class="chip">‚è±Ô∏è HH:MM:SS + decimal hours</span>
          <span class="chip">üåô Cross midnight supported</span>
          <span class="chip">‚ûï Add / ‚ûñ Subtract intervals</span>
        </div>
      </div>

      <section>
        <div id="premium-time-duration">
          <div class="calc-shell">

            <!-- Inputs -->
            <div class="panel" aria-label="Time duration inputs">
              <div class="panel-title">
                <h2>Inputs</h2>
                <span class="pill">‚úÖ Inputs</span>
              </div>

              <div class="tabs" role="tablist" aria-label="Time calculator mode">
                <button class="tab" id="td_tab_duration" role="tab" aria-selected="true" aria-controls="td_panel_duration" type="button">Duration</button>
                <button class="tab" id="td_tab_addsub" role="tab" aria-selected="false" aria-controls="td_panel_addsub" type="button">Add/Subtract</button>
              </div>

              <!-- Duration panel -->
              <div id="td_panel_duration" role="tabpanel" aria-labelledby="td_tab_duration">
                <div class="grid-2">
                  <div class="field">
                    <label for="td_start">Start time</label>
                    <input id="td_start" class="input" type="time" step="1" value="09:00:00">
                    <p class="help">Use HH:MM:SS (seconds optional on some browsers).</p>
                  </div>

                  <div class="field">
                    <label for="td_end">End time</label>
                    <input id="td_end" class="input" type="time" step="1" value="17:30:00">
                    <p class="help">If end is next day, enable Cross midnight.</p>
                  </div>

                  <div class="field" style="grid-column:1 / -1;">
                    <label style="display:flex;gap:10px;align-items:center;font-weight:900;">
                      <input id="td_cross" type="checkbox" style="width:18px;height:18px;">
                      Cross midnight (treat end time as next day)
                    </label>
                    <p class="help">Example: start 22:00 and end 06:00 ‚Üí 8 hours (when enabled).</p>
                  </div>
                </div>
              </div>

              <!-- Add/Subtract panel -->
              <div id="td_panel_addsub" role="tabpanel" aria-labelledby="td_tab_addsub" style="display:none;">
                <div class="grid-2">
                  <div class="field">
                    <label for="td_base">Base time</label>
                    <input id="td_base" class="input" type="time" step="1" value="09:00:00">
                    <p class="help">The time you want to change.</p>
                  </div>

                  <div class="field">
                    <label for="td_op">Operation</label>
                    <select id="td_op" class="input">
                      <option value="add" selected>Add</option>
                      <option value="sub">Subtract</option>
                    </select>
                    <p class="help">Apply interval to base time.</p>
                  </div>

                  <div class="field">
                    <label for="td_h">Hours</label>
                    <input id="td_h" class="input" type="number" inputmode="numeric" min="0" step="1" value="1">
                    <p class="help">Interval hours.</p>
                  </div>

                  <div class="field">
                    <label for="td_m">Minutes</label>
                    <input id="td_m" class="input" type="number" inputmode="numeric" min="0" step="1" value="30">
                    <p class="help">Interval minutes.</p>
                  </div>

                  <div class="field">
                    <label for="td_s">Seconds</label>
                    <input id="td_s" class="input" type="number" inputmode="numeric" min="0" step="1" value="0">
                    <p class="help">Interval seconds.</p>
                  </div>

                  <div class="field">
                    <label for="td_wrap">Wrap within 24h</label>
                    <select id="td_wrap" class="input">
                      <option value="1" selected>Yes (show time of day)</option>
                      <option value="0">No (allow negative / >24h)</option>
                    </select>
                    <p class="help">Most users want ‚Äútime of day‚Äù result.</p>
                  </div>
                </div>
              </div>

              <div class="actions">
                <button class="btn" id="td_calc_btn" type="button">Calculate</button>
                <button class="btn btn-dark" id="td_example_btn" type="button">Try Example</button>
                <button class="btn btn-ghost" id="td_reset_btn" type="button">Reset</button>
              </div>

              <div class="mini" style="margin-top:10px;">
                Tip: If your end time is earlier than start time, enable <strong>Cross midnight</strong> to treat it as next day.
              </div>
            </div>

            <!-- Results -->
            <div class="panel sticky" aria-label="Time duration results">
              <div class="panel-title">
                <h2>Results</h2>
                <span class="pill">üî• Output</span>
              </div>

              <div class="metric">
                <p class="k" id="td_primary_label">Duration</p>
                <p class="v" id="td_out_hms">‚Äî</p>
                <p class="mini" id="td_out_note">‚Äî</p>
              </div>

              <div class="metric alt">
                <p class="k">Decimal hours</p>
                <p class="v" id="td_out_hours">‚Äî</p>
                <p class="mini">Rounded to 4 decimals.</p>
              </div>

              <div class="metric">
                <p class="k">Total minutes</p>
                <p class="v" id="td_out_minutes">‚Äî</p>
                <div class="bar"><span id="td_bar"></span></div>
                <p class="mini" id="td_out_seconds">‚Äî</p>
              </div>

              <div class="metric alt">
                <p class="k">Summary</p>
                <p class="mini" id="td_out_summary">Enter inputs and click Calculate.</p>
              </div>
            </div>

          </div>

          <h2 style="margin:18px 0 6px;">Breakdown</h2>
          <p class="mini" style="margin:0 0 10px;">Useful for timesheets and shift calculations.</p>

          <div class="table-wrap">
            <table aria-label="Time breakdown table">
              <thead>
                <tr>
                  <th>Part</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody id="td_table">
                <tr><td colspan="2" class="mini">Click <strong>Calculate</strong> to see breakdown.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section style="margin-top:18px;">
        <h2>Explanation</h2>
        <p>
          This <strong>Time Duration Calculator</strong> helps you compute the difference between two times (duration)
          or add/subtract an interval from a base time. It‚Äôs useful for shift planning, timesheets, study sessions,
          travel timing, and productivity tracking.
        </p>
        <p class="mini">
          Tip: For overnight shifts, enable <strong>Cross midnight</strong> so the end time is treated as the next day.
        </p>
      </section>

      <section>
        <h3>Formula</h3>
        <pre>Duration (seconds) = end_seconds ‚àí start_seconds
If Cross midnight and end &lt; start: end_seconds += 24√ó3600</pre>
      </section>

      <section class="faqs">
        <h3>FAQs</h3>
        <details class="card"><summary><strong>Cross midnight?</strong></summary><p>If end time is earlier than start time, enable cross-midnight to treat the end as next day.</p></details>
        <details class="card"><summary><strong>Format?</strong></summary><p>Outputs include HH:MM:SS, decimal hours, total minutes, and total seconds.</p></details>
        <details class="card"><summary><strong>Timezones?</strong></summary><p>Convert both times to the same timezone before comparing if they come from different zones.</p></details>
        <details class="card"><summary><strong>Business use?</strong></summary><p>Perfect for timesheets, shift durations, billing hours, and project tracking.</p></details>
        <details class="card"><summary><strong>Precision?</strong></summary><p>Seconds precision is supported. Milliseconds are not shown to keep the UI simple.</p></details>
      </section>

      <section class="related" style="margin-top:18px;">
        <h3>Related calculators</h3>
        <div class="cards-grid related-grid">
          <a class="card" href="age-calculator.html"><h4>Age Calculator</h4><p>Calculate age from date of birth to today or a target date.</p></a>
          <a class="card" href="date-difference-calculator.html"><h4>Date Difference Calculator</h4><p>Find difference between two dates in days, months, years.</p></a>
          <a class="card" href="unit-converter.html"><h4>Unit Converter</h4><p>Convert between length, mass, volume, temperature and more.</p></a>
          <a class="card" href="fuel-cost-calculator.html"><h4>Fuel Cost Calculator</h4><p>Estimate trip fuel cost using distance and mileage.</p></a>
        </div>
      </section>
    </article>
  </main>

  <footer class="site-footer">
    <div class="wrap" style="padding:18px 0;color:#64748b;">
      <p>&copy; CalculatorSolution</p>
      <p style="margin-top:8px;font-size:0.9rem;line-height:1.8;">
        <a href="/sitemap.xml">Sitemap</a> |
        <a href="/">Home</a> |
        <a href="/privacy-policy.html">Privacy Policy</a> |
        <a href="/terms-of-service.html">Terms</a> |
        <a href="/contact.html">Contact</a> |
        <a href="/about.html">About</a>
      </p>
    </div>
  </footer>

  <!-- ‚úÖ LOGIC UNCHANGED -->
  <script>
    (function(){
      const $ = (id)=>document.getElementById(id);

      const tabDuration = $('td_tab_duration');
      const tabAddSub = $('td_tab_addsub');
      const panelDuration = $('td_panel_duration');
      const panelAddSub = $('td_panel_addsub');

      const startEl = $('td_start');
      const endEl = $('td_end');
      const crossEl = $('td_cross');

      const baseEl = $('td_base');
      const opEl = $('td_op');
      const hEl = $('td_h');
      const mEl = $('td_m');
      const sEl = $('td_s');
      const wrapEl = $('td_wrap');

      const primaryLabel = $('td_primary_label');
      const outHms = $('td_out_hms');
      const outNote = $('td_out_note');
      const outHours = $('td_out_hours');
      const outMinutes = $('td_out_minutes');
      const outSeconds = $('td_out_seconds');
      const outSummary = $('td_out_summary');
      const bar = $('td_bar');
      const tbody = $('td_table');

      function setMode(mode){
        const isDuration = mode === 'duration';
        tabDuration.setAttribute('aria-selected', isDuration ? 'true' : 'false');
        tabAddSub.setAttribute('aria-selected', isDuration ? 'false' : 'true');
        panelDuration.style.display = isDuration ? 'block' : 'none';
        panelAddSub.style.display = isDuration ? 'none' : 'block';
        primaryLabel.textContent = isDuration ? 'Duration' : 'Result time';
      }

      tabDuration.addEventListener('click', ()=>{ setMode('duration'); calc(); });
      tabAddSub.addEventListener('click', ()=>{ setMode('addsub'); calc(); });

      function parseTimeToSeconds(val){
        // val like "HH:MM" or "HH:MM:SS"
        if(!val) return NaN;
        const parts = String(val).split(':').map(x=>parseInt(x,10));
        if(parts.length < 2) return NaN;
        const hh = parts[0]||0, mm = parts[1]||0, ss = parts[2]||0;
        if(hh<0||hh>23||mm<0||mm>59||ss<0||ss>59) return NaN;
        return hh*3600 + mm*60 + ss;
      }

      function secondsToHms(sec){
        const sign = sec < 0 ? '-' : '';
        sec = Math.abs(sec);
        const hh = Math.floor(sec/3600);
        const mm = Math.floor((sec%3600)/60);
        const ss = Math.floor(sec%60);
        const pad = (n)=> String(n).padStart(2,'0');
        return sign + pad(hh) + ':' + pad(mm) + ':' + pad(ss);
      }

      function secondsToTimeOfDay(sec){
        // wrap 0..86399
        const mod = ((sec % 86400) + 86400) % 86400;
        const hh = Math.floor(mod/3600);
        const mm = Math.floor((mod%3600)/60);
        const ss = Math.floor(mod%60);
        const pad = (n)=> String(n).padStart(2,'0');
        return pad(hh) + ':' + pad(mm) + ':' + pad(ss);
      }

      function render(seconds, mode){
        if(!isFinite(seconds)){
          outHms.textContent = '‚Äî';
          outNote.textContent = 'Enter valid values.';
          outHours.textContent = '‚Äî';
          outMinutes.textContent = '‚Äî';
          outSeconds.textContent = '‚Äî';
          outSummary.textContent = 'Enter inputs and click Calculate.';
          bar.style.width = '0%';
          tbody.innerHTML = '<tr><td colspan="2" class="mini">Click <strong>Calculate</strong> to see breakdown.</td></tr>';
          return;
        }

        const abs = Math.abs(seconds);
        const hh = Math.floor(abs/3600);
        const mm = Math.floor((abs%3600)/60);
        const ss = Math.floor(abs%60);

        const decHours = seconds / 3600;
        const totalMin = seconds / 60;

        outHours.textContent = (Math.round(decHours*10000)/10000).toString();
        outMinutes.textContent = (Math.round(totalMin*10000)/10000).toString();
        outSeconds.textContent = `Total seconds: ${seconds.toFixed(0)}`;

        // bar: map minutes into 0..12h for a nice UI bar (cap at 100%)
        const pct = Math.min(100, (abs / (12*3600))*100);
        bar.style.width = pct.toFixed(1) + '%';
        bar.style.background = 'linear-gradient(90deg, rgba(168,85,247,.9), rgba(59,130,246,.9))';

        if(mode === 'duration'){
          outHms.textContent = secondsToHms(seconds);
          outNote.textContent = seconds < 0 ? 'Negative duration (end earlier than start). Enable Cross midnight if needed.' : 'Duration in HH:MM:SS.';
          outSummary.textContent = `Duration = ${secondsToHms(seconds)} (${outHours.textContent} hours)`;
        } else {
          const wrap = wrapEl.value === '1';
          outHms.textContent = wrap ? secondsToTimeOfDay(seconds) : secondsToHms(seconds);
          outNote.textContent = wrap ? 'Wrapped within 24 hours.' : 'Not wrapped (can be negative or exceed 24h).';
          outSummary.textContent = `Result time = ${outHms.textContent}`;
        }

        tbody.innerHTML = `
          <tr><td>Hours</td><td>${seconds < 0 ? '-' : ''}${hh}</td></tr>
          <tr><td>Minutes</td><td>${mm}</td></tr>
          <tr><td>Seconds</td><td>${ss}</td></tr>
          <tr><td>Decimal hours</td><td>${(Math.round(decHours*10000)/10000)}</td></tr>
          <tr><td>Total minutes</td><td>${(Math.round(totalMin*10000)/10000)}</td></tr>
          <tr><td>Total seconds</td><td>${seconds.toFixed(0)}</td></tr>
        `;
      }

      function calc(){
        const isDuration = tabDuration.getAttribute('aria-selected') === 'true';

        if(isDuration){
          const startS = parseTimeToSeconds(startEl.value);
          const endS = parseTimeToSeconds(endEl.value);
          if(!isFinite(startS) || !isFinite(endS)){
            render(NaN, 'duration'); return;
          }
          let diff = endS - startS;
          if(crossEl.checked && diff < 0){
            diff += 86400; // add 24 hours
          }
          render(diff, 'duration');
          return;
        }

        // add/subtract
        const baseS = parseTimeToSeconds(baseEl.value);
        const h = parseFloat(hEl.value) || 0;
        const m = parseFloat(mEl.value) || 0;
        const s = parseFloat(sEl.value) || 0;
        if(!isFinite(baseS) || h<0 || m<0 || s<0){
          render(NaN, 'addsub'); return;
        }
        const delta = (h*3600) + (m*60) + s;
        const op = opEl.value;
        const result = (op === 'sub') ? (baseS - delta) : (baseS + delta);
        render(result, 'addsub');
      }

      $('td_calc_btn').addEventListener('click', calc);

      $('td_example_btn').addEventListener('click', ()=>{
        // Example: night shift duration
        setMode('duration');
        startEl.value = '22:15:00';
        endEl.value = '06:45:00';
        crossEl.checked = true;
        calc();
      });

      $('td_reset_btn').addEventListener('click', ()=>{
        setMode('duration');
        startEl.value = '09:00:00';
        endEl.value = '17:30:00';
        crossEl.checked = false;

        baseEl.value = '09:00:00';
        opEl.value = 'add';
        hEl.value = '1';
        mEl.value = '30';
        sEl.value = '0';
        wrapEl.value = '1';

        render(NaN, 'duration');
      });

      // Auto-calc on input for smooth UX
      [startEl,endEl,crossEl,baseEl,opEl,hEl,mEl,sEl,wrapEl].forEach(el=>{
        el.addEventListener('input', calc);
        el.addEventListener('change', calc);
      });

      // init
      setMode('duration');
      render(NaN, 'duration');
      calc();
    })();
  </script>
</body>
</html>
