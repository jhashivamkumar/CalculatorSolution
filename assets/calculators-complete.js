// Complete Calculators Library - All 74 Calculators with Full Functionality
// This file provides complete interactive implementations for all calculators

(function(){
  const mapping = {
    // FINANCE CALCULATORS
    'percentage-calculator': {
      render: ()=>`<div class="form-row"><input data-name="part" type="number" placeholder="Part (e.g. 25)" /><input data-name="whole" type="number" placeholder="Whole (e.g. 200)" /><button data-action="calc" class="btn">Calculate %</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const p=parseFloat(el.querySelector('[data-name=part]').value)||0; const w=parseFloat(el.querySelector('[data-name=whole]').value)||0; const out=el.querySelector('[data-out]'); if(w===0){ out.textContent='Enter non-zero whole value'; return } out.innerHTML='<strong>'+p/w*100+'.toFixed(2)%</strong> - Formula: ('+p+'/'+w+')*100' }) }
    },
    'percentage-change-calculator': {
      render: ()=>`<div class="form-row"><input data-name="old" type="number" placeholder="Old value" /><input data-name="new" type="number" placeholder="New value" /><button data-action="calc" class="btn">Calculate % Change</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const oldv=parseFloat(el.querySelector('[data-name=old]').value)||0; const newv=parseFloat(el.querySelector('[data-name=new]').value)||0; const out=el.querySelector('[data-out]'); if(oldv===0){ out.textContent='Old value cannot be zero'; return } const pc=((newv-oldv)/oldv)*100; out.innerHTML='<strong>'+pc.toFixed(2)+'%</strong>' }) }
    },
    'discount-calculator': {
      render: ()=>`<div class="form-row"><input data-name="price" type="number" placeholder="Original price" /><input data-name="disc" type="number" placeholder="Discount %" /><button data-action="calc" class="btn">Apply Discount</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const price=parseFloat(el.querySelector('[data-name=price]').value)||0; const d=parseFloat(el.querySelector('[data-name=disc]').value)||0; const out=el.querySelector('[data-out]'); const discounted=price*(1-d/100); const saved=price-discounted; out.innerHTML='<strong>Final Price: '+discounted.toFixed(2)+'</strong> — Saved: '+saved.toFixed(2) }) }
    },
    'gst-calculator-india': {
      render: ()=>`<div class="form-row"><input data-name="price" type="number" placeholder="Price" /><input data-name="rate" type="number" placeholder="GST rate %" /><select data-name="mode"><option value="add">Add GST</option><option value="extract">Extract GST</option></select><button data-action="calc" class="btn">Calculate GST</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const price=parseFloat(el.querySelector('[data-name=price]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const mode=el.querySelector('[data-name=mode]').value; const out=el.querySelector('[data-out]'); if(mode==='add'){ const gst=price*rate/100; const total=price+gst; out.innerHTML='<strong>GST: '+gst.toFixed(2)+'</strong> — Total: '+total.toFixed(2) } else { const base=price/(1+rate/100); const gst=price-base; out.innerHTML='<strong>Base: '+base.toFixed(2)+'</strong> — GST: '+gst.toFixed(2) } }) }
    },
    'simple-interest-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Principal (P)" /><input data-name="R" type="number" placeholder="Rate % per annum" /><input data-name="T" type="number" placeholder="Time (years)" /><button data-action="calc" class="btn">Calculate Interest</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const T=parseFloat(el.querySelector('[data-name=T]').value)||0; const out=el.querySelector('[data-out]'); const interest=P*R*T/100; const total=P+interest; out.innerHTML='<strong>Interest: '+interest.toFixed(2)+'</strong> — Total: '+total.toFixed(2) }) }
    },
    'compound-interest-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Principal" /><input data-name="R" type="number" placeholder="Annual Rate %" /><input data-name="n" type="number" placeholder="Compounds per year" /><input data-name="t" type="number" placeholder="Years" /><button data-action="calc" class="btn">Calculate Compound Interest</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const n=parseFloat(el.querySelector('[data-name=n]').value)||1; const t=parseFloat(el.querySelector('[data-name=t]').value)||0; const out=el.querySelector('[data-out]'); const r=R/100; const A=P*Math.pow(1+r/n,n*t); const CI=A-P; out.innerHTML='<strong>Future Value: '+A.toFixed(2)+'</strong> — Compound Interest: '+CI.toFixed(2) }) }
    },
    'loan-emi-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Principal (loan amount)" /><input data-name="R" type="number" placeholder="Annual Interest Rate %" /><input data-name="T" type="number" placeholder="Tenure (years)" /><button data-action="calc" class="btn">Calculate EMI</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const T=parseFloat(el.querySelector('[data-name=T]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<0||T<=0){ out.textContent='Enter valid positive values'; return } const r=R/12/100; const n=T*12; const numerator=P*r*Math.pow(1+r,n); const denominator=Math.pow(1+r,n)-1; const emi=numerator/denominator; const totalPayment=emi*n; const interest=totalPayment-P; out.innerHTML='<strong>EMI: '+emi.toFixed(2)+'</strong><br/>Total Payment: '+totalPayment.toFixed(2)+' | Interest: '+interest.toFixed(2) }) }
    },
    'home-loan-emi-calculator': {
      render: ()=>`<div class="form-row"><input data-name="loanAmount" type="number" placeholder="Loan Amount" /><input data-name="rate" type="number" placeholder="Interest Rate % (annual)" /><input data-name="years" type="number" placeholder="Loan Tenure (years)" /><button data-action="calc" class="btn">Calculate EMI</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=loanAmount]').value)||0; const R=parseFloat(el.querySelector('[data-name=rate]').value)||0; const T=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<0||T<=0){ out.textContent='Enter valid positive values'; return } const r=R/12/100; const n=T*12; const emi=P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); out.innerHTML='<strong>Monthly EMI: '+emi.toFixed(2)+'</strong><br/>Total Amount: '+(emi*n).toFixed(2)+' | Total Interest: '+((emi*n)-P).toFixed(2) }) }
    },
    'sip-calculator': {
      render: ()=>`<div class="form-row"><input data-name="monthly" type="number" placeholder="Monthly Investment" /><input data-name="rate" type="number" placeholder="Annual Return %" /><input data-name="years" type="number" placeholder="Years" /><button data-action="calc" class="btn">Calculate SIP Returns</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=monthly]').value)||0; const R=parseFloat(el.querySelector('[data-name=rate]').value)||0; const T=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||T<=0){ out.textContent='Enter valid positive values'; return } const r=R/12/100; const n=T*12; const fv=P*((Math.pow(1+r,n)-1)/r)*(1+r); out.innerHTML='<strong>Future Value: '+fv.toFixed(2)+'</strong><br/>Total Invested: '+(P*n).toFixed(2)+' | Gain: '+(fv-P*n).toFixed(2) }) }
    },
    'fd-calculator': {
      render: ()=>`<div class="form-row"><input data-name="amount" type="number" placeholder="Deposit Amount" /><input data-name="rate" type="number" placeholder="Interest Rate % (annual)" /><input data-name="years" type="number" placeholder="Duration (years)" /><button data-action="calc" class="btn">Calculate Maturity</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=amount]').value)||0; const R=parseFloat(el.querySelector('[data-name=rate]').value)||0; const T=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||T<=0){ out.textContent='Enter valid positive values'; return } const maturity=P*Math.pow(1+R/100,T); const interest=maturity-P; out.innerHTML='<strong>Maturity Amount: '+maturity.toFixed(2)+'</strong><br/>Interest Earned: '+interest.toFixed(2) }) }
    },
    'currency-converter': {
      render: ()=>`<div class="form-row"><input data-name="amount" type="number" placeholder="Amount" /><select data-name="from"><option value="USD">USD</option><option value="EUR">EUR</option><option value="INR">INR</option><option value="GBP">GBP</option><option value="JPY">JPY</option></select><select data-name="to"><option value="INR">INR</option><option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option><option value="JPY">JPY</option></select><button data-action="calc" class="btn">Convert</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const amt=parseFloat(el.querySelector('[data-name=amount]').value)||0; const from=el.querySelector('[data-name=from]').value; const to=el.querySelector('[data-name=to]').value; const out=el.querySelector('[data-out]'); const rates={USD:1,EUR:0.85,INR:74.5,GBP:0.73,JPY:110}; if(!rates[from]||!rates[to]){ out.textContent='Currency not supported'; return } const converted=amt*rates[to]/rates[from]; out.innerHTML='<strong>'+amt.toFixed(2)+' '+from+' = '+converted.toFixed(2)+' '+to+'</strong>' }) }
    },
    'profit-calculator': {
      render: ()=>`<div class="form-row"><input data-name="cost" type="number" placeholder="Cost Price" /><input data-name="sell" type="number" placeholder="Selling Price" /><button data-action="calc" class="btn">Calculate Profit</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const cp=parseFloat(el.querySelector('[data-name=cost]').value)||0; const sp=parseFloat(el.querySelector('[data-name=sell]').value)||0; const out=el.querySelector('[data-out]'); if(cp===0){ out.textContent='Cost price cannot be zero'; return } const profit=sp-cp; const profitPct=profit/cp*100; out.innerHTML='<strong>Profit: '+profit.toFixed(2)+'</strong> ('+profitPct.toFixed(2)+'%)' }) }
    },
    'loss-calculator': {
      render: ()=>`<div class="form-row"><input data-name="cost" type="number" placeholder="Cost Price" /><input data-name="sell" type="number" placeholder="Selling Price" /><button data-action="calc" class="btn">Calculate Loss</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const cp=parseFloat(el.querySelector('[data-name=cost]').value)||0; const sp=parseFloat(el.querySelector('[data-name=sell]').value)||0; const out=el.querySelector('[data-out]'); if(cp===0){ out.textContent='Cost price cannot be zero'; return } const loss=cp-sp; const lossPct=loss/cp*100; out.innerHTML='<strong>Loss: '+loss.toFixed(2)+'</strong> ('+lossPct.toFixed(2)+'%)' }) }
    },
    'break-even-calculator': {
      render: ()=>`<div class="form-row"><input data-name="fixed" type="number" placeholder="Fixed Costs" /><input data-name="price" type="number" placeholder="Price per Unit" /><input data-name="variable" type="number" placeholder="Variable Cost per Unit" /><button data-action="calc" class="btn">Calculate Break-Even</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const fixed=parseFloat(el.querySelector('[data-name=fixed]').value)||0; const price=parseFloat(el.querySelector('[data-name=price]').value)||0; const variable=parseFloat(el.querySelector('[data-name=variable]').value)||0; const out=el.querySelector('[data-out]'); const cm=price-variable; if(cm<=0){ out.textContent='Contribution margin must be positive'; return } const units=fixed/cm; const revenue=units*price; out.innerHTML='<strong>Break-Even Units: '+Math.ceil(units)+'</strong><br/>Revenue: '+revenue.toFixed(2) }) }
    },
    'roi-calculator': {
      render: ()=>`<div class="form-row"><input data-name="invested" type="number" placeholder="Amount Invested" /><input data-name="gained" type="number" placeholder="Final Value" /><button data-action="calc" class="btn">Calculate ROI</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const invested=parseFloat(el.querySelector('[data-name=invested]').value)||0; const gained=parseFloat(el.querySelector('[data-name=gained]').value)||0; const out=el.querySelector('[data-out]'); if(invested<=0){ out.textContent='Investment must be positive'; return } const roi=((gained-invested)/invested)*100; out.innerHTML='<strong>ROI: '+roi.toFixed(2)+'%</strong><br/>Gain: '+(gained-invested).toFixed(2) }) }
    },
    'tip-calculator': {
      render: ()=>`<div class="form-row"><input data-name="bill" type="number" placeholder="Bill Amount" /><input data-name="tip" type="number" placeholder="Tip %" /><input data-name="people" type="number" placeholder="Number of People" /><button data-action="calc" class="btn">Calculate Tip</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const bill=parseFloat(el.querySelector('[data-name=bill]').value)||0; const tipPct=parseFloat(el.querySelector('[data-name=tip]').value)||0; const people=parseFloat(el.querySelector('[data-name=people]').value)||1; const out=el.querySelector('[data-out]'); const tipAmount=bill*tipPct/100; const total=bill+tipAmount; const perPerson=total/people; out.innerHTML='<strong>Tip: '+tipAmount.toFixed(2)+'</strong><br/>Total: '+total.toFixed(2)+' | Per Person: '+perPerson.toFixed(2) }) }
    },
    'unit-price-calculator': {
      render: ()=>`<div class="form-row"><input data-name="total" type="number" placeholder="Total Price" /><input data-name="units" type="number" placeholder="Number of Units" /><button data-action="calc" class="btn">Calculate Unit Price</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const total=parseFloat(el.querySelector('[data-name=total]').value)||0; const units=parseFloat(el.querySelector('[data-name=units]').value)||0; const out=el.querySelector('[data-out]'); if(units===0){ out.textContent='Units cannot be zero'; return } const unitPrice=total/units; out.innerHTML='<strong>Unit Price: '+unitPrice.toFixed(4)+'</strong>' }) }
    },
    'invoice-total-calculator': {
      render: ()=>`<div class="form-row"><input data-name="subtotal" type="number" placeholder="Subtotal" /><input data-name="tax" type="number" placeholder="Tax %" /><input data-name="discount" type="number" placeholder="Discount %" /><button data-action="calc" class="btn">Calculate Total</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const subtotal=parseFloat(el.querySelector('[data-name=subtotal]').value)||0; const taxPct=parseFloat(el.querySelector('[data-name=tax]').value)||0; const discountPct=parseFloat(el.querySelector('[data-name=discount]').value)||0; const out=el.querySelector('[data-out]'); const discount=subtotal*discountPct/100; const afterDiscount=subtotal-discount; const tax=afterDiscount*taxPct/100; const total=afterDiscount+tax; out.innerHTML='<strong>Subtotal: '+subtotal.toFixed(2)+'</strong> — Discount: '+discount.toFixed(2)+' — Tax: '+tax.toFixed(2)+' — <strong>Total: '+total.toFixed(2)+'</strong>' }) }
    },
    'margin-markup-calculator': {
      render: ()=>`<div class="form-row"><input data-name="cost" type="number" placeholder="Cost Price" /><input data-name="sell" type="number" placeholder="Selling Price" /><button data-action="calc" class="btn">Calculate Margin & Markup</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const cost=parseFloat(el.querySelector('[data-name=cost]').value)||0; const sell=parseFloat(el.querySelector('[data-name=sell]').value)||0; const out=el.querySelector('[data-out]'); if(cost===0||sell===0){ out.textContent='Enter positive values'; return } const profit=sell-cost; const margin=(profit/sell)*100; const markup=(profit/cost)*100; out.innerHTML='<strong>Profit: '+profit.toFixed(2)+'</strong> | Margin: '+margin.toFixed(2)+'% | Markup: '+markup.toFixed(2)+'%' }) }
    },
    'vat-calculator': {
      render: ()=>`<div class="form-row"><input data-name="price" type="number" placeholder="Price" /><input data-name="rate" type="number" placeholder="VAT Rate %" /><select data-name="mode"><option value="add">Add VAT</option><option value="extract">Extract VAT</option></select><button data-action="calc" class="btn">Calculate VAT</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const price=parseFloat(el.querySelector('[data-name=price]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const mode=el.querySelector('[data-name=mode]').value; const out=el.querySelector('[data-out]'); if(mode==='add'){ const vat=price*rate/100; const total=price+vat; out.innerHTML='<strong>VAT: '+vat.toFixed(2)+'</strong> — Total: '+total.toFixed(2) } else { const base=price/(1+rate/100); const vat=price-base; out.innerHTML='<strong>Base: '+base.toFixed(2)+'</strong> — VAT: '+vat.toFixed(2) } }) }
    },

    // HEALTH CALCULATORS  
    'bmi-calculator': {
      render: ()=>`<div class="form-row"><select data-name="unit"><option value="metric">Metric (kg, m)</option><option value="imperial">Imperial (lb, in)</option></select><input data-name="weight" type="number" placeholder="Weight" /><input data-name="height" type="number" placeholder="Height" /><button data-action="calc" class="btn">Calculate BMI</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const unit=el.querySelector('[data-name=unit]').value; const w=parseFloat(el.querySelector('[data-name=weight]').value)||0; const h=parseFloat(el.querySelector('[data-name=height]').value)||0; const out=el.querySelector('[data-out]'); if(w<=0||h<=0){ out.textContent='Enter positive values'; return } let bmi; if(unit==='metric'){ bmi=w/(h*h) } else { bmi=(w/(h*h))*703 } let category='Normal'; if(bmi<18.5)category='Underweight'; else if(bmi<25)category='Normal'; else if(bmi<30)category='Overweight'; else category='Obese'; out.innerHTML='<strong>BMI: '+bmi.toFixed(2)+'</strong> — '+category }) }
    },
    'bmr-calculator': {
      render: ()=>`<div class="form-row"><select data-name="sex"><option value="m">Male</option><option value="f">Female</option></select><input data-name="age" type="number" placeholder="Age" /><input data-name="weight" type="number" placeholder="Weight (kg)" /><input data-name="height" type="number" placeholder="Height (cm)" /><button data-action="calc" class="btn">Calculate BMR</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const sex=el.querySelector('[data-name=sex]').value; const age=parseFloat(el.querySelector('[data-name=age]').value)||0; const weight=parseFloat(el.querySelector('[data-name=weight]').value)||0; const height=parseFloat(el.querySelector('[data-name=height]').value)||0; const out=el.querySelector('[data-out]'); if(age<=0||weight<=0||height<=0){ out.textContent='Enter positive values'; return } let bmr; if(sex==='m'){ bmr=10*weight+6.25*height-5*age+5 } else { bmr=10*weight+6.25*height-5*age-161 } out.innerHTML='<strong>BMR: '+bmr.toFixed(0)+' cal/day</strong>' }) }
    },
    'daily-calorie-needs-calculator': {
      render: ()=>`<div class="form-row"><input data-name="bmr" type="number" placeholder="BMR (cal/day)" /><select data-name="activity"><option value="1.2">Sedentary</option><option value="1.375">Lightly Active</option><option value="1.55">Moderately Active</option><option value="1.725">Very Active</option><option value="1.9">Extremely Active</option></select><button data-action="calc" class="btn">Calculate Daily Calories</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const bmr=parseFloat(el.querySelector('[data-name=bmr]').value)||0; const activity=parseFloat(el.querySelector('[data-name=activity]').value)||1.2; const out=el.querySelector('[data-out]'); if(bmr<=0){ out.textContent='Enter valid BMR'; return } const tdee=bmr*activity; out.innerHTML='<strong>Daily Calorie Needs: '+tdee.toFixed(0)+'</strong>' }) }
    },
    'calories-burned-running-walking': {
      render: ()=>`<div class="form-row"><input data-name="weight" type="number" placeholder="Weight (kg)" /><input data-name="time" type="number" placeholder="Duration (minutes)" /><input data-name="speed" type="number" placeholder="Speed (km/h)" /><button data-action="calc" class="btn">Calculate Calories Burned</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const weight=parseFloat(el.querySelector('[data-name=weight]').value)||0; const time=parseFloat(el.querySelector('[data-name=time]').value)||0; const speed=parseFloat(el.querySelector('[data-name=speed]').value)||0; const out=el.querySelector('[data-out]'); if(weight<=0||time<=0){ out.textContent='Enter positive values'; return } let met=3.5; if(speed>10)met=11.5; else if(speed>8)met=8.3; else if(speed>6)met=5; const calories=met*weight*time/60; out.innerHTML='<strong>Calories Burned: '+calories.toFixed(0)+'</strong>' }) }
    },
    'ideal-weight-calculator': {
      render: ()=>`<div class="form-row"><input data-name="height" type="number" placeholder="Height (cm)" /><select data-name="formula"><option value="devine">Devine</option><option value="robinson">Robinson</option></select><button data-action="calc" class="btn">Calculate Ideal Weight</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const height=parseFloat(el.querySelector('[data-name=height]').value)||0; const formula=el.querySelector('[data-name=formula]').value; const out=el.querySelector('[data-out]'); if(height<=0){ out.textContent='Enter valid height'; return } let weight; if(formula==='devine'){ weight=50+(height-152.4)*0.9 } else { weight=52+(height-152.4)*1.9 } out.innerHTML='<strong>Ideal Weight Range: '+Math.round(weight-5)+'-'+Math.round(weight+5)+' kg</strong>' }) }
    },

    // UTILITY CALCULATORS
    'unit-converter': {
      render: ()=>`<div class="form-row"><input data-name="value" type="number" placeholder="Value" /><select data-name="from"><option value="m">Meters</option><option value="km">Kilometers</option><option value="ft">Feet</option><option value="mi">Miles</option></select><select data-name="to"><option value="ft">Feet</option><option value="m">Meters</option><option value="km">Kilometers</option><option value="mi">Miles</option></select><button data-action="calc" class="btn">Convert</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const value=parseFloat(el.querySelector('[data-name=value]').value)||0; const from=el.querySelector('[data-name=from]').value; const to=el.querySelector('[data-name=to]').value; const out=el.querySelector('[data-out]'); const toMeter={m:1,km:1000,ft:0.3048,mi:1609.34}; const result=value*toMeter[from]/toMeter[to]; out.innerHTML='<strong>'+value+' '+from+' = '+result.toFixed(4)+' '+to+'</strong>' }) }
    },
    'date-difference-calculator': {
      render: ()=>`<div class="form-row"><input data-name="date1" type="date" /><input data-name="date2" type="date" /><button data-action="calc" class="btn">Calculate Difference</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const d1=new Date(el.querySelector('[data-name=date1]').value); const d2=new Date(el.querySelector('[data-name=date2]').value); const out=el.querySelector('[data-out]'); const diff=Math.abs(d2-d1); const days=Math.floor(diff/86400000); const weeks=Math.floor(days/7); const months=Math.floor(days/30.44); const years=Math.floor(months/12); out.innerHTML='<strong>'+days+' days</strong> = '+weeks+' weeks = '+months+' months = '+years.toFixed(1)+' years' }) }
    },
    'time-duration-calculator': {
      render: ()=>`<div class="form-row"><input data-name="hours" type="number" placeholder="Hours" /><input data-name="minutes" type="number" placeholder="Minutes" /><input data-name="seconds" type="number" placeholder="Seconds" /><button data-action="calc" class="btn">Calculate Total</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const h=parseFloat(el.querySelector('[data-name=hours]').value)||0; const m=parseFloat(el.querySelector('[data-name=minutes]').value)||0; const s=parseFloat(el.querySelector('[data-name=seconds]').value)||0; const out=el.querySelector('[data-out]'); const totalSeconds=h*3600+m*60+s; out.innerHTML='<strong>Total: '+totalSeconds+' seconds</strong> = '+(totalSeconds/60).toFixed(2)+' minutes = '+(totalSeconds/3600).toFixed(2)+' hours' }) }
    },
    'download-time-calculator': {
      render: ()=>`<div class="form-row"><input data-name="size" type="number" placeholder="File Size (MB)" /><input data-name="speed" type="number" placeholder="Speed (Mbps)" /><button data-action="calc" class="btn">Calculate Time</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const size=parseFloat(el.querySelector('[data-name=size]').value)||0; const speed=parseFloat(el.querySelector('[data-name=speed]').value)||0; const out=el.querySelector('[data-out]'); if(speed<=0){ out.textContent='Speed must be positive'; return } const seconds=size*8/speed; const minutes=seconds/60; const hours=minutes/60; out.innerHTML='<strong>Time: '+seconds.toFixed(2)+' seconds</strong> = '+minutes.toFixed(2)+' minutes = '+hours.toFixed(2)+' hours' }) }
    },

    // EDUCATION CALCULATORS
    'gpa-calculator': {
      render: ()=>`<div class="form-row"><input data-name="grades" type="text" placeholder="Grades (e.g. A,B,A,C)" /><input data-name="credits" type="text" placeholder="Credits (e.g. 3,3,4,2)" /><button data-action="calc" class="btn">Calculate GPA</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const gradesStr=el.querySelector('[data-name=grades]').value; const creditsStr=el.querySelector('[data-name=credits]').value; const out=el.querySelector('[data-out]'); const gradeMap={A:4,B:3,C:2,D:1,F:0}; const grades=gradesStr.split(',').map(g=>gradeMap[g.trim()]||0); const credits=creditsStr.split(',').map(c=>parseFloat(c)||0); if(credits.length===0||grades.length===0){ out.textContent='Enter valid grades and credits'; return } const totalPoints=grades.reduce((a,b,i)=>a+b*credits[i],0); const totalCredits=credits.reduce((a,b)=>a+b,0); const gpa=totalPoints/totalCredits; out.innerHTML='<strong>GPA: '+gpa.toFixed(2)+'</strong>' }) }
    },
    'grade-calculator': {
      render: ()=>`<div class="form-row"><input data-name="obtained" type="number" placeholder="Marks Obtained" /><input data-name="total" type="number" placeholder="Total Marks" /><button data-action="calc" class="btn">Calculate Percentage</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const obtained=parseFloat(el.querySelector('[data-name=obtained]').value)||0; const total=parseFloat(el.querySelector('[data-name=total]').value)||0; const out=el.querySelector('[data-out]'); if(total===0){ out.textContent='Total cannot be zero'; return } const percentage=obtained/total*100; let grade='F'; if(percentage>=90)grade='A'; else if(percentage>=75)grade='B'; else if(percentage>=60)grade='C'; else if(percentage>=45)grade='D'; out.innerHTML='<strong>Percentage: '+percentage.toFixed(2)+'% — Grade: '+grade+'</strong>' }) }
    },
    'reading-time-calculator': {
      render: ()=>`<div class="form-row"><input data-name="words" type="number" placeholder="Number of Words" /><input data-name="wpm" type="number" placeholder="Reading Speed (words/min)" /><button data-action="calc" class="btn">Calculate Time</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const words=parseFloat(el.querySelector('[data-name=words]').value)||0; const wpm=parseFloat(el.querySelector('[data-name=wpm]').value)||200; const out=el.querySelector('[data-out]'); if(wpm<=0){ out.textContent='Reading speed must be positive'; return } const minutes=words/wpm; const seconds=minutes*60; out.innerHTML='<strong>Time: '+minutes.toFixed(2)+' minutes</strong> = '+seconds.toFixed(0)+' seconds' }) }
    },

    // ADD-ONS
    'steps-to-calories-calculator': {
      render: ()=>`<div class="form-row"><input data-name="steps" type="number" placeholder="Number of Steps" /><input data-name="weight" type="number" placeholder="Weight (kg)" /><button data-action="calc" class="btn">Calculate Calories</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const steps=parseFloat(el.querySelector('[data-name=steps]').value)||0; const weight=parseFloat(el.querySelector('[data-name=weight]').value)||0; const out=el.querySelector('[data-out]'); if(weight<=0){ out.textContent='Enter valid weight'; return } const distance=steps*0.000762; const calories=distance*weight*1.036; out.innerHTML='<strong>Calories Burned: '+calories.toFixed(0)+'</strong> (Distance: '+distance.toFixed(2)+' km)' }) }
    },
    'fuel-cost-calculator': {
      render: ()=>`<div class="form-row"><input data-name="distance" type="number" placeholder="Distance (km)" /><input data-name="mileage" type="number" placeholder="Mileage (km/liter)" /><input data-name="price" type="number" placeholder="Fuel Price per Liter" /><button data-action="calc" class="btn">Calculate Cost</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const distance=parseFloat(el.querySelector('[data-name=distance]').value)||0; const mileage=parseFloat(el.querySelector('[data-name=mileage]').value)||0; const price=parseFloat(el.querySelector('[data-name=price]').value)||0; const out=el.querySelector('[data-out]'); if(mileage<=0){ out.textContent='Mileage must be positive'; return } const liters=distance/mileage; const cost=liters*price; out.innerHTML='<strong>Fuel Cost: '+cost.toFixed(2)+'</strong> (Liters: '+liters.toFixed(2)+')' }) }
    },
    'bandwidth-calculator': {
      render: ()=>`<div class="form-row"><input data-name="files" type="number" placeholder="Number of Files" /><input data-name="filesize" type="number" placeholder="File Size (MB)" /><input data-name="speed" type="number" placeholder="Speed (Mbps)" /><button data-action="calc" class="btn">Calculate Time</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const files=parseFloat(el.querySelector('[data-name=files]').value)||0; const filesize=parseFloat(el.querySelector('[data-name=filesize]').value)||0; const speed=parseFloat(el.querySelector('[data-name=speed]').value)||0; const out=el.querySelector('[data-out]'); if(speed<=0){ out.textContent='Speed must be positive'; return } const totalSize=files*filesize; const seconds=totalSize*8/speed; out.innerHTML='<strong>Time: '+seconds.toFixed(0)+' seconds ('+Math.round(seconds/60)+' min)</strong>' }) }
    },
    'travel-distance-cost-split': {
      render: ()=>`<div class="form-row"><input data-name="distance" type="number" placeholder="Distance (km)" /><input data-name="rate" type="number" placeholder="Rate per km" /><input data-name="people" type="number" placeholder="Number of People" /><button data-action="calc" class="btn">Calculate Split</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const distance=parseFloat(el.querySelector('[data-name=distance]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const people=parseFloat(el.querySelector('[data-name=people]').value)||1; const out=el.querySelector('[data-out]'); const totalCost=distance*rate; const perPerson=totalCost/people; out.innerHTML='<strong>Total Cost: '+totalCost.toFixed(2)+'</strong> — Per Person: '+perPerson.toFixed(2) }) }
    },
    'area-calculator': {
      render: ()=>`<div class="form-row"><select data-name="shape"><option value="rectangle">Rectangle</option><option value="circle">Circle</option><option value="triangle">Triangle</option></select><div id="inputs"></div><button data-action="calc" class="btn">Calculate Area</button></div><div data-out class="result"></div>`,
      bind: el=>{ const shapeSelect=el.querySelector('[data-name=shape]'); const inputsDiv=el.querySelector('#inputs'); const updateInputs=()=>{ const shape=shapeSelect.value; inputsDiv.innerHTML=''; if(shape==='rectangle'){ inputsDiv.innerHTML='<input data-name=\"length\" type=\"number\" placeholder=\"Length\" /><input data-name=\"width\" type=\"number\" placeholder=\"Width\" />'; } else if(shape==='circle'){ inputsDiv.innerHTML='<input data-name=\"radius\" type=\"number\" placeholder=\"Radius\" />'; } else { inputsDiv.innerHTML='<input data-name=\"base\" type=\"number\" placeholder=\"Base\" /><input data-name=\"height\" type=\"number\" placeholder=\"Height\" />'; } }; updateInputs(); shapeSelect.addEventListener('change', updateInputs); el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const shape=shapeSelect.value; const out=el.querySelector('[data-out]'); let area=0; if(shape==='rectangle'){ const l=parseFloat(el.querySelector('[data-name=length]').value)||0; const w=parseFloat(el.querySelector('[data-name=width]').value)||0; area=l*w; } else if(shape==='circle'){ const r=parseFloat(el.querySelector('[data-name=radius]').value)||0; area=Math.PI*r*r; } else { const b=parseFloat(el.querySelector('[data-name=base]').value)||0; const h=parseFloat(el.querySelector('[data-name=height]').value)||0; area=0.5*b*h; } out.innerHTML='<strong>Area: '+area.toFixed(2)+' sq units</strong>' }) }
    },

    // Additional finance calculators
    'car-loan-emi-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Car price/loan amount" /><input data-name="R" type="number" placeholder="Annual Rate %" /><input data-name="T" type="number" placeholder="Tenure (years)" /><button data-action="calc" class="btn">Calculate EMI</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const T=parseFloat(el.querySelector('[data-name=T]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<=0||T<=0){ out.textContent='Enter positive loan, rate, tenure'; return } const r=R/12/100, n=T*12, emi=P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); const total=emi*n; out.innerHTML='<strong>EMI: '+emi.toFixed(2)+'</strong><br/>Total Payable: '+total.toFixed(2)+' | Interest: '+(total-P).toFixed(2) }) }
    },
    'personal-loan-emi-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Loan amount" /><input data-name="R" type="number" placeholder="Annual Rate %" /><input data-name="T" type="number" placeholder="Tenure (years)" /><button data-action="calc" class="btn">Calculate EMI</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const T=parseFloat(el.querySelector('[data-name=T]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<=0||T<=0){ out.textContent='Enter positive loan, rate, tenure'; return } const r=R/12/100, n=T*12, emi=P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); const total=emi*n; out.innerHTML='<strong>EMI: '+emi.toFixed(2)+'</strong><br/>Total Payable: '+total.toFixed(2)+' | Interest: '+(total-P).toFixed(2) }) }
    },
    'rd-calculator': {
      render: ()=>`<div class="form-row"><input data-name="monthly" type="number" placeholder="Monthly deposit" /><input data-name="rate" type="number" placeholder="Annual Rate %" /><input data-name="years" type="number" placeholder="Years" /><button data-action="calc" class="btn">Calculate RD</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=monthly]').value)||0; const R=parseFloat(el.querySelector('[data-name=rate]').value)||0; const T=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<0||T<=0){ out.textContent='Enter valid monthly amount, rate, years'; return } const r=R/12/100; const n=T*12; const maturity=P*((Math.pow(1+r,n)-1)/r); const invested=P*n; out.innerHTML='<strong>Maturity: '+maturity.toFixed(2)+'</strong><br/>Invested: '+invested.toFixed(2)+' | Interest: '+(maturity-invested).toFixed(2) }) }
    },
    'salary-inhand-calculator': {
      render: ()=>`<div class="form-row"><input data-name="gross" type="number" placeholder="Monthly gross salary" /><input data-name="pf" type="number" placeholder="PF % (e.g. 12)" /><input data-name="tax" type="number" placeholder="Tax % (e.g. 10)" /><button data-action="calc" class="btn">Calculate Take-home</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const gross=parseFloat(el.querySelector('[data-name=gross]').value)||0; const pfPct=parseFloat(el.querySelector('[data-name=pf]').value)||0; const taxPct=parseFloat(el.querySelector('[data-name=tax]').value)||0; const out=el.querySelector('[data-out]'); const pf=gross*pfPct/100; const tax=gross*taxPct/100; const take=gross-pf-tax; out.innerHTML='<strong>In-hand: '+take.toFixed(2)+'</strong><br/>PF: '+pf.toFixed(2)+' | Tax: '+tax.toFixed(2) }) }
    },
    'income-tax-india-calculator': {
      render: ()=>`<div class="form-row"><input data-name="income" type="number" placeholder="Annual taxable income" /><button data-action="calc" class="btn">Estimate Tax</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const income=parseFloat(el.querySelector('[data-name=income]').value)||0; const out=el.querySelector('[data-out]'); if(income<=0){ out.textContent='Enter income'; return } const slabs=[[300000,0.00],[600000,0.05],[900000,0.10],[1200000,0.15],[1500000,0.20],[Infinity,0.30]]; let remaining=income, last=0, tax=0; slabs.forEach(([limit,rate])=>{ if(remaining<=0)return; const chunk=Math.min(remaining,limit-last); tax+=chunk*rate; remaining-=chunk; last=limit; }); const effective=(tax/income)*100; out.innerHTML='<strong>Estimated Tax: '+tax.toFixed(2)+'</strong><br/>Effective Rate: '+effective.toFixed(2)+'%' }) }
    },
    'emi-vs-rent-calculator': {
      render: ()=>`<div class="form-row"><input data-name="price" type="number" placeholder="Property price / loan amount" /><input data-name="rate" type="number" placeholder="Loan rate % (annual)" /><input data-name="years" type="number" placeholder="Tenure (years)" /><input data-name="rent" type="number" placeholder="Monthly rent" /><button data-action="calc" class="btn">Compare EMI vs Rent</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=price]').value)||0; const R=parseFloat(el.querySelector('[data-name=rate]').value)||0; const T=parseFloat(el.querySelector('[data-name=years]').value)||0; const rent=parseFloat(el.querySelector('[data-name=rent]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<=0||T<=0){ out.textContent='Enter valid price, rate, years'; return } const r=R/12/100, n=T*12, emi=P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); const totalEmi=emi*n; const totalRent=rent*n; out.innerHTML='<strong>Monthly EMI: '+emi.toFixed(2)+'</strong><br/>Total EMI over tenure: '+totalEmi.toFixed(2)+' vs Rent: '+totalRent.toFixed(2) }) }
    },
    'credit-card-interest-calculator': {
      render: ()=>`<div class="form-row"><input data-name="balance" type="number" placeholder="Outstanding balance" /><input data-name="rate" type="number" placeholder="Annual interest rate %" /><input data-name="months" type="number" placeholder="Months" /><button data-action="calc" class="btn">Calculate Interest</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const bal=parseFloat(el.querySelector('[data-name=balance]').value)||0; const R=parseFloat(el.querySelector('[data-name=rate]').value)||0; const m=parseFloat(el.querySelector('[data-name=months]').value)||0; const out=el.querySelector('[data-out]'); const monthly=R/12/100; const interest=bal*monthly*m; out.innerHTML='<strong>Interest: '+interest.toFixed(2)+'</strong><br/>Total Due: '+(bal+interest).toFixed(2) }) }
    },
    'inflation-calculator': {
      render: ()=>`<div class="form-row"><input data-name="amount" type="number" placeholder="Amount today" /><input data-name="rate" type="number" placeholder="Inflation % per year" /><input data-name="years" type="number" placeholder="Years" /><button data-action="calc" class="btn">Adjust for inflation</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const amt=parseFloat(el.querySelector('[data-name=amount]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const years=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); const future=amt*Math.pow(1+rate/100,years); out.innerHTML='<strong>Future equivalent: '+future.toFixed(2)+'</strong>' }) }
    },
    'budget-calculator': {
      render: ()=>`<div class="form-row"><input data-name="income" type="number" placeholder="Monthly income" /><input data-name="expenses" type="number" placeholder="Monthly expenses" /><button data-action="calc" class="btn">Calculate Budget</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const income=parseFloat(el.querySelector('[data-name=income]').value)||0; const expenses=parseFloat(el.querySelector('[data-name=expenses]').value)||0; const out=el.querySelector('[data-out]'); const savings=income-expenses; const rate=income? (savings/income*100):0; out.innerHTML='<strong>Savings: '+savings.toFixed(2)+'</strong><br/>Savings Rate: '+rate.toFixed(2)+'%' }) }
    },
    'subscription-pricing-calculator': {
      render: ()=>`<div class="form-row"><input data-name="cost" type="number" placeholder="Cost per user/month" /><input data-name="margin" type="number" placeholder="Target margin %" /><input data-name="tax" type="number" placeholder="Tax/VAT %" /><button data-action="calc" class="btn">Calculate Price</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const cost=parseFloat(el.querySelector('[data-name=cost]').value)||0; const margin=parseFloat(el.querySelector('[data-name=margin]').value)||0; const tax=parseFloat(el.querySelector('[data-name=tax]').value)||0; const priceBeforeTax=cost/(1-margin/100); const priceWithTax=priceBeforeTax*(1+tax/100); const out=el.querySelector('[data-out]'); out.innerHTML='<strong>Customer price: '+priceWithTax.toFixed(2)+'</strong><br/>Before tax: '+priceBeforeTax.toFixed(2)+' | Tax: '+(priceWithTax-priceBeforeTax).toFixed(2) }) }
    },
    'nps-calculator': {
      render: ()=>`<div class="form-row"><input data-name="monthly" type="number" placeholder="Monthly contribution" /><input data-name="rate" type="number" placeholder="Expected return % (annual)" /><input data-name="years" type="number" placeholder="Years till retirement" /><button data-action="calc" class="btn">Calculate NPS Corpus</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const monthly=parseFloat(el.querySelector('[data-name=monthly]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const years=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); const r=rate/12/100; const n=years*12; const corpus=monthly*((Math.pow(1+r,n)-1)/r)*(1+r); const invested=monthly*n; out.innerHTML='<strong>Projected Corpus: '+corpus.toFixed(2)+'</strong><br/>Invested: '+invested.toFixed(2)+' | Gain: '+(corpus-invested).toFixed(2) }) }
    },
    'swp-calculator': {
      render: ()=>`<div class="form-row"><input data-name="lump" type="number" placeholder="Lump sum invested" /><input data-name="rate" type="number" placeholder="Expected return % (annual)" /><input data-name="withdraw" type="number" placeholder="Monthly withdrawal" /><button data-action="calc" class="btn">Estimate Duration</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ let bal=parseFloat(el.querySelector('[data-name=lump]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const withdraw=parseFloat(el.querySelector('[data-name=withdraw]').value)||0; const out=el.querySelector('[data-out]'); if(bal<=0||withdraw<=0){ out.textContent='Enter balance and withdrawal'; return } const r=rate/12/100; let months=0; while(bal>0 && months<1200){ bal=bal*(1+r)-withdraw; months++; } const years=(months/12).toFixed(1); out.innerHTML='<strong>Lasts about '+months+' months</strong> (~'+years+' years)' }) }
    },
    'gratuity-calculator': {
      render: ()=>`<div class="form-row"><input data-name="salary" type="number" placeholder="Last drawn salary (basic + DA)" /><input data-name="years" type="number" placeholder="Years of service" /><button data-action="calc" class="btn">Calculate Gratuity</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const salary=parseFloat(el.querySelector('[data-name=salary]').value)||0; const years=parseFloat(el.querySelector('[data-name=years]').value)||0; const out=el.querySelector('[data-out]'); if(salary<=0||years<=0){ out.textContent='Enter salary and years'; return } const gratuity=salary*15/26*Math.floor(years); out.innerHTML='<strong>Gratuity: '+gratuity.toFixed(2)+'</strong>' }) }
    },
    'epf-contribution-calculator': {
      render: ()=>`<div class="form-row"><input data-name="basic" type="number" placeholder="Basic salary" /><input data-name="employee" type="number" placeholder="Employee % (e.g. 12)" /><input data-name="employer" type="number" placeholder="Employer % (e.g. 12)" /><button data-action="calc" class="btn">Calculate EPF</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const basic=parseFloat(el.querySelector('[data-name=basic]').value)||0; const empPct=parseFloat(el.querySelector('[data-name=employee]').value)||0; const erPct=parseFloat(el.querySelector('[data-name=employer]').value)||0; const out=el.querySelector('[data-out]'); const emp=basic*empPct/100; const er=basic*erPct/100; out.innerHTML='<strong>Monthly EPF: '+(emp+er).toFixed(2)+'</strong><br/>Employee: '+emp.toFixed(2)+' | Employer: '+er.toFixed(2) }) }
    },
    'hra-calculator': {
      render: ()=>`<div class="form-row"><input data-name="basic" type="number" placeholder="Basic salary" /><input data-name="hra" type="number" placeholder="HRA received" /><input data-name="rent" type="number" placeholder="Annual rent paid" /><select data-name="metro"><option value="metro">Metro city</option><option value="non">Non-metro</option></select><button data-action="calc" class="btn">Calculate HRA Exemption</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const basic=parseFloat(el.querySelector('[data-name=basic]').value)||0; const hra=parseFloat(el.querySelector('[data-name=hra]').value)||0; const rent=parseFloat(el.querySelector('[data-name=rent]').value)||0; const metro=el.querySelector('[data-name=metro]').value==='metro'; const out=el.querySelector('[data-out]'); const excessRent=Math.max(0, rent - 0.1*basic); const limitBasic=basic*(metro?0.5:0.4); const exemption=Math.min(hra, excessRent, limitBasic); out.innerHTML='<strong>HRA Exempt: '+exemption.toFixed(2)+'</strong><br/>Taxable HRA: '+Math.max(0, hra-exemption).toFixed(2) }) }
    },
    'debt-payoff-calculator': {
      render: ()=>`<div class="form-row"><input data-name="balance" type="number" placeholder="Current balance" /><input data-name="rate" type="number" placeholder="Annual rate %" /><input data-name="payment" type="number" placeholder="Monthly payment" /><button data-action="calc" class="btn">Estimate Payoff</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ let bal=parseFloat(el.querySelector('[data-name=balance]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const pay=parseFloat(el.querySelector('[data-name=payment]').value)||0; const out=el.querySelector('[data-out]'); if(bal<=0||rate<0||pay<=0){ out.textContent='Enter valid balance, rate, payment'; return } const r=rate/12/100; if(pay<=bal*r){ out.textContent='Payment too low to cover interest'; return } let months=0; let interest=0; while(bal>0 && months<1200){ const int=bal*r; interest+=int; bal=bal+int-pay; months++; } const years=(months/12).toFixed(1); out.innerHTML='<strong>Payoff in '+months+' months</strong> (~'+years+' years)<br/>Total interest: '+interest.toFixed(2) }) }
    },
    'net-worth-calculator': {
      render: ()=>`<div class="form-row"><input data-name="assets" type="number" placeholder="Total assets" /><input data-name="liabilities" type="number" placeholder="Total liabilities" /><button data-action="calc" class="btn">Calculate Net Worth</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const assets=parseFloat(el.querySelector('[data-name=assets]').value)||0; const liab=parseFloat(el.querySelector('[data-name=liabilities]').value)||0; const out=el.querySelector('[data-out]'); const net=assets-liab; out.innerHTML='<strong>Net Worth: '+net.toFixed(2)+'</strong>' }) }
    },
    'freelancer-earnings-calculator': {
      render: ()=>`<div class="form-row"><input data-name="rate" type="number" placeholder="Hourly rate" /><input data-name="hours" type="number" placeholder="Hours worked" /><input data-name="expenses" type="number" placeholder="Expenses" /><input data-name="tax" type="number" placeholder="Tax % on revenue" /><button data-action="calc" class="btn">Calculate Earnings</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const hours=parseFloat(el.querySelector('[data-name=hours]').value)||0; const expenses=parseFloat(el.querySelector('[data-name=expenses]').value)||0; const taxPct=parseFloat(el.querySelector('[data-name=tax]').value)||0; const out=el.querySelector('[data-out]'); const revenue=rate*hours; const tax=revenue*taxPct/100; const net=revenue-expenses-tax; out.innerHTML='<strong>Net: '+net.toFixed(2)+'</strong><br/>Revenue: '+revenue.toFixed(2)+' | Expenses: '+expenses.toFixed(2)+' | Tax: '+tax.toFixed(2) }) }
    },
    'car-loan-vs-cash-calculator': {
      render: ()=>`<div class="form-row"><input data-name="price" type="number" placeholder="Car price" /><input data-name="rate" type="number" placeholder="Loan rate % (annual)" /><input data-name="years" type="number" placeholder="Loan tenure (years)" /><input data-name="invest" type="number" placeholder="Investment return % (annual)" /><button data-action="calc" class="btn">Compare</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const price=parseFloat(el.querySelector('[data-name=price]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const years=parseFloat(el.querySelector('[data-name=years]').value)||0; const invest=parseFloat(el.querySelector('[data-name=invest]').value)||0; const out=el.querySelector('[data-out]'); const r=rate/12/100, n=years*12; const emi=price*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); const totalLoan=emi*n; const investValue=price*Math.pow(1+invest/100,years); out.innerHTML='<strong>Loan total: '+totalLoan.toFixed(2)+'</strong><br/>Cash+invest scenario (if invested at '+invest+'%): '+investValue.toFixed(2) }) }
    },
    'savings-goal-calculator': {
      render: ()=>`<div class="form-row"><input data-name="target" type="number" placeholder="Goal amount" /><input data-name="current" type="number" placeholder="Current savings" /><input data-name="monthly" type="number" placeholder="Monthly contribution" /><input data-name="rate" type="number" placeholder="Expected return % (annual)" /><button data-action="calc" class="btn">Check Goal</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const target=parseFloat(el.querySelector('[data-name=target]').value)||0; const current=parseFloat(el.querySelector('[data-name=current]').value)||0; const monthly=parseFloat(el.querySelector('[data-name=monthly]').value)||0; const rate=parseFloat(el.querySelector('[data-name=rate]').value)||0; const out=el.querySelector('[data-out]'); const r=rate/12/100; let bal=current; let months=0; while(bal<target && months<1200){ bal=bal*(1+r)+monthly; months++; } if(months>=1200){ out.textContent='Goal exceeds 100 years; increase savings or return.'; return } out.innerHTML='<strong>Goal in '+months+' months</strong> (~'+(months/12).toFixed(1)+' years). Projected balance: '+bal.toFixed(2) }) }
    },
    'forex-profit-calculator': {
      render: ()=>`<div class="form-row"><input data-name="entry" type="number" placeholder="Entry price" /><input data-name="exit" type="number" placeholder="Exit price" /><input data-name="units" type="number" placeholder="Units/lot size" /><button data-action="calc" class="btn">Calculate Profit</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const entry=parseFloat(el.querySelector('[data-name=entry]').value)||0; const exit=parseFloat(el.querySelector('[data-name=exit]').value)||0; const units=parseFloat(el.querySelector('[data-name=units]').value)||0; const out=el.querySelector('[data-out]'); const profit=(exit-entry)*units; const pct=entry? (profit/(entry*units))*100:0; out.innerHTML='<strong>Profit: '+profit.toFixed(2)+'</strong> ('+pct.toFixed(2)+'%)' }) }
    },
    'mortgage-amortization-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Loan amount" /><input data-name="R" type="number" placeholder="Annual rate %" /><input data-name="T" type="number" placeholder="Tenure (years)" /><button data-action="calc" class="btn">Calculate</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const T=parseFloat(el.querySelector('[data-name=T]').value)||0; const out=el.querySelector('[data-out]'); if(P<=0||R<=0||T<=0){ out.textContent='Enter positive values'; return } const r=R/12/100, n=T*12; const emi=P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); const total=emi*n; out.innerHTML='<strong>Monthly Payment: '+emi.toFixed(2)+'</strong><br/>Total Interest: '+(total-P).toFixed(2) }) }
    },
    'credit-score-estimator': {
      render: ()=>`<div class="form-row"><input data-name="history" type="number" placeholder="On-time payments % (0-100)" /><input data-name="util" type="number" placeholder="Credit utilization % (0-100)" /><input data-name="inquiries" type="number" placeholder="Hard inquiries (last 12m)" /><button data-action="calc" class="btn">Estimate Score</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const history=parseFloat(el.querySelector('[data-name=history]').value)||0; const util=parseFloat(el.querySelector('[data-name=util]').value)||0; const inquiries=parseFloat(el.querySelector('[data-name=inquiries]').value)||0; const out=el.querySelector('[data-out]'); const score=Math.max(300, Math.min(850, 300 + history*3 - util*2 - inquiries*10)); out.innerHTML='<strong>Estimated score: '+Math.round(score)+'</strong><br/>Keep utilization under 30% and payments at 100% for best results.' }) }
    },
    'emi-prepayment-calculator': {
      render: ()=>`<div class="form-row"><input data-name="P" type="number" placeholder="Current principal" /><input data-name="R" type="number" placeholder="Annual rate %" /><input data-name="T" type="number" placeholder="Remaining years" /><input data-name="prepay" type="number" placeholder="One-time prepayment" /><button data-action="calc" class="btn">Calculate Savings</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ let P=parseFloat(el.querySelector('[data-name=P]').value)||0; const R=parseFloat(el.querySelector('[data-name=R]').value)||0; const T=parseFloat(el.querySelector('[data-name=T]').value)||0; const prepay=parseFloat(el.querySelector('[data-name=prepay]').value)||0; const out=el.querySelector('[data-out]'); const r=R/12/100; let n=T*12; const emi=P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1); if(prepay>0){ P=Math.max(0, P-prepay); } let balance=P; let months=0; let interest=0; while(balance>0 && months<1200){ const int=balance*r; interest+=int; balance=balance+int-emi; months++; } const savedMonths=Math.max(0, T*12 - months); out.innerHTML='<strong>New payoff: '+months+' months</strong> (saved '+savedMonths+' months)<br/>Estimated interest over remaining term: '+interest.toFixed(2) }) }
    },
    'crypto-percentage-profit-calculator': {
      render: ()=>`<div class="form-row"><input data-name="buy" type="number" placeholder="Buy price" /><input data-name="sell" type="number" placeholder="Sell price" /><input data-name="amount" type="number" placeholder="Quantity" /><button data-action="calc" class="btn">Calculate Profit %</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const buy=parseFloat(el.querySelector('[data-name=buy]').value)||0; const sell=parseFloat(el.querySelector('[data-name=sell]').value)||0; const amt=parseFloat(el.querySelector('[data-name=amount]').value)||0; const out=el.querySelector('[data-out]'); if(buy<=0){ out.textContent='Buy price must be positive'; return } const profit=(sell-buy)*amt; const pct=((sell-buy)/buy)*100; out.innerHTML='<strong>Profit: '+profit.toFixed(2)+'</strong> ('+pct.toFixed(2)+'%)' }) }
    },

    // Remaining health/utility/education calculators
    'body-fat-percentage-calculator': {
      render: ()=>`<div class="form-row"><select data-name="sex"><option value="m">Male</option><option value="f">Female</option></select><input data-name="waist" type="number" placeholder="Waist (cm)" /><input data-name="neck" type="number" placeholder="Neck (cm)" /><input data-name="height" type="number" placeholder="Height (cm)" /><input data-name="hip" type="number" placeholder="Hip (cm, females)" /><button data-action="calc" class="btn">Estimate Body Fat</button></div><div data-out class="result"></div>`,
      bind: el=>{ const log10=v=>Math.log(v)/Math.LN10; el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const sex=el.querySelector('[data-name=sex]').value; const waist=parseFloat(el.querySelector('[data-name=waist]').value)||0; const neck=parseFloat(el.querySelector('[data-name=neck]').value)||0; const height=parseFloat(el.querySelector('[data-name=height]').value)||0; const hip=parseFloat(el.querySelector('[data-name=hip]').value)||0; const out=el.querySelector('[data-out]'); if(height<=0||waist<=0||neck<=0){ out.textContent='Enter measurements'; return } let bf=0; if(sex==='m'){ bf = 495/(1.0324 - 0.19077*log10(waist - neck) + 0.15456*log10(height)) - 450; } else { bf = 495/(1.29579 - 0.35004*log10(waist + hip - neck) + 0.22100*log10(height)) - 450; } out.innerHTML='<strong>Estimated body fat: '+bf.toFixed(2)+'%</strong>' }) }
    },
    'water-intake-calculator': {
      render: ()=>`<div class="form-row"><input data-name="weight" type="number" placeholder="Weight (kg)" /><button data-action="calc" class="btn">Calculate Daily Intake</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const w=parseFloat(el.querySelector('[data-name=weight]').value)||0; const out=el.querySelector('[data-out]'); if(w<=0){ out.textContent='Enter weight'; return } const liters=w*0.033; out.innerHTML='<strong>'+liters.toFixed(2)+' liters/day</strong> (~'+(liters*33.814).toFixed(0)+' oz)' }) }
    },
    'pregnancy-due-date-calculator': {
      render: ()=>`<div class="form-row"><input data-name="lmp" type="date" /><input data-name="cycle" type="number" placeholder="Cycle length (days, default 28)" /><button data-action="calc" class="btn">Estimate Due Date</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const lmp=new Date(el.querySelector('[data-name=lmp]').value); const cycle=parseFloat(el.querySelector('[data-name=cycle]').value)||28; const out=el.querySelector('[data-out]'); if(!lmp.getTime()){ out.textContent='Enter last period date'; return } const due=new Date(lmp.getTime()); due.setDate(due.getDate()+280+(cycle-28)); out.innerHTML='<strong>Estimated due date: '+due.toDateString()+'</strong>' }) }
    },
    'ovulation-calculator': {
      render: ()=>`<div class="form-row"><input data-name="lmp" type="date" /><input data-name="cycle" type="number" placeholder="Cycle length (days)" /><button data-action="calc" class="btn">Estimate Ovulation</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const lmp=new Date(el.querySelector('[data-name=lmp]').value); const cycle=parseFloat(el.querySelector('[data-name=cycle]').value)||28; const out=el.querySelector('[data-out]'); if(!lmp.getTime()){ out.textContent='Enter last period date'; return } const ov=new Date(lmp.getTime()); ov.setDate(ov.getDate()+cycle-14); out.innerHTML='<strong>Estimated ovulation: '+ov.toDateString()+'</strong>' }) }
    },
    'target-heart-rate-calculator': {
      render: ()=>`<div class="form-row"><input data-name="age" type="number" placeholder="Age" /><button data-action="calc" class="btn">Calculate Target HR</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const age=parseFloat(el.querySelector('[data-name=age]').value)||0; const out=el.querySelector('[data-out]'); const max=220-age; const moderate=[max*0.5, max*0.7]; const intense=[max*0.7, max*0.85]; out.innerHTML='<strong>Max HR: '+max.toFixed(0)+' bpm</strong><br/>Moderate: '+moderate[0].toFixed(0)+'-'+moderate[1].toFixed(0)+' | Intense: '+intense[0].toFixed(0)+'-'+intense[1].toFixed(0) }) }
    },
    'child-growth-percentile-calculator': {
      render: ()=>`<div class="form-row"><input data-name="age" type="number" placeholder="Age (years)" /><input data-name="height" type="number" placeholder="Height (cm)" /><button data-action="calc" class="btn">Estimate Percentile</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const age=parseFloat(el.querySelector('[data-name=age]').value)||0; const height=parseFloat(el.querySelector('[data-name=height]').value)||0; const out=el.querySelector('[data-out]'); if(age<=0||height<=0){ out.textContent='Enter age and height'; return } const expected=50+age*5; const pct=Math.max(1, Math.min(99, (height/expected)*50)); out.innerHTML='<strong>Approx percentile: '+pct.toFixed(0)+'th</strong> (use official growth chart for accuracy)' }) }
    },
    'waist-to-hip-ratio-calculator': {
      render: ()=>`<div class="form-row"><input data-name="waist" type="number" placeholder="Waist (cm)" /><input data-name="hip" type="number" placeholder="Hip (cm)" /><button data-action="calc" class="btn">Calculate W/H Ratio</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const waist=parseFloat(el.querySelector('[data-name=waist]').value)||0; const hip=parseFloat(el.querySelector('[data-name=hip]').value)||0; const out=el.querySelector('[data-out]'); if(waist<=0||hip<=0){ out.textContent='Enter waist and hip'; return } const ratio=waist/hip; let risk='Low'; if(ratio>0.9) risk='High'; else if(ratio>0.85) risk='Moderate'; out.innerHTML='<strong>W/H Ratio: '+ratio.toFixed(2)+'</strong> ('+risk+' risk)' }) }
    },
    'calories-deficit-weight-loss-calculator': {
      render: ()=>`<div class="form-row"><input data-name="current" type="number" placeholder="Current weight (kg)" /><input data-name="goal" type="number" placeholder="Goal weight (kg)" /><input data-name="weeks" type="number" placeholder="Weeks to goal" /><button data-action="calc" class="btn">Calculate Deficit</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const current=parseFloat(el.querySelector('[data-name=current]').value)||0; const goal=parseFloat(el.querySelector('[data-name=goal]').value)||0; const weeks=parseFloat(el.querySelector('[data-name=weeks]').value)||0; const out=el.querySelector('[data-out]'); const kgLoss=Math.max(0, current-goal); const calories=kgLoss*7700; const daily=weeks>0? calories/(weeks*7):0; out.innerHTML='<strong>Daily deficit: '+daily.toFixed(0)+' kcal</strong> to lose '+kgLoss.toFixed(1)+' kg in '+weeks+' weeks' }) }
    },
    'diabetes-sugar-converter': {
      render: ()=>`<div class="form-row"><input data-name="mg" type="number" placeholder="Glucose mg/dL" /><button data-action="calc" class="btn">Convert to mmol/L</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const mg=parseFloat(el.querySelector('[data-name=mg]').value)||0; const out=el.querySelector('[data-out]'); const mmol=mg/18; out.innerHTML='<strong>'+mg.toFixed(1)+' mg/dL = '+mmol.toFixed(2)+' mmol/L</strong>' }) }
    },
    'age-calculator': {
      render: ()=>`<div class="form-row"><input data-name="dob" type="date" /><button data-action="calc" class="btn">Calculate Age</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const dob=new Date(el.querySelector('[data-name=dob]').value); const out=el.querySelector('[data-out]'); if(!dob.getTime()){ out.textContent='Enter birth date'; return } const diff=Date.now()-dob.getTime(); const ageDate=new Date(diff); const years=Math.abs(ageDate.getUTCFullYear()-1970); out.innerHTML='<strong>'+years+' years old</strong>' }) }
    },
    'cgpa-calculator': {
      render: ()=>`<div class="form-row"><input data-name="gpas" type="text" placeholder="Semester GPAs comma-separated" /><button data-action="calc" class="btn">Calculate CGPA</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const gpas=el.querySelector('[data-name=gpas]').value.split(',').map(x=>parseFloat(x)||0).filter(x=>x>0); const out=el.querySelector('[data-out]'); if(!gpas.length){ out.textContent='Enter GPA values'; return } const avg=gpas.reduce((a,b)=>a+b,0)/gpas.length; out.innerHTML='<strong>CGPA: '+avg.toFixed(2)+'</strong>' }) }
    },
    'percentage-needed-final-exam': {
      render: ()=>`<div class="form-row"><input data-name="current" type="number" placeholder="Current overall %" /><input data-name="currentWeight" type="number" placeholder="Completed weight % (e.g. 70)" /><input data-name="desired" type="number" placeholder="Desired course %" /><button data-action="calc" class="btn">Calculate Needed on Final</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const current=parseFloat(el.querySelector('[data-name=current]').value)||0; const weight=parseFloat(el.querySelector('[data-name=currentWeight]').value)||0; const desired=parseFloat(el.querySelector('[data-name=desired]').value)||0; const out=el.querySelector('[data-out]'); const remainingWeight=100-weight; if(remainingWeight<=0){ out.textContent='Course already fully graded'; return } const needed=(desired - current*(weight/100))/(remainingWeight/100); out.innerHTML='<strong>Need about '+needed.toFixed(2)+'% on remaining assessments</strong>' }) }
    },
    'aspect-ratio-calculator': {
      render: ()=>`<div class="form-row"><input data-name="width" type="number" placeholder="Width" /><input data-name="height" type="number" placeholder="Height" /><input data-name="target" type="number" placeholder="Target width or height" /><select data-name="mode"><option value="width">Match width</option><option value="height">Match height</option></select><button data-action="calc" class="btn">Calculate Ratio</button></div><div data-out class="result"></div>`,
      bind: el=>{ el.querySelector('[data-action]')?.addEventListener('click', ()=>{ const w=parseFloat(el.querySelector('[data-name=width]').value)||0; const h=parseFloat(el.querySelector('[data-name=height]').value)||0; const target=parseFloat(el.querySelector('[data-name=target]').value)||0; const mode=el.querySelector('[data-name=mode]').value; const out=el.querySelector('[data-out]'); if(w<=0||h<=0){ out.textContent='Enter width and height'; return } const gcd=(a,b)=>b?gcd(b,a%b):a; const g=gcd(Math.round(w),Math.round(h))||1; const ratio=w/g+':'+h/g; let scaled=''; if(target>0){ if(mode==='width'){ scaled='Height at '+target+' width: '+(target*h/w).toFixed(2); } else { scaled='Width at '+target+' height: '+(target*w/h).toFixed(2); } } out.innerHTML='<strong>Aspect ratio: '+ratio+'</strong>'+ (scaled? '<br/>'+scaled:'') }) }
    }
  };

  // Fallback for any missing calculators
  const fallbackRender = (slug) => `<div class="card"><p style="margin:0;">Calculator UI for <strong>${slug.replace(/-/g,' ')}</strong> is coming soon. Use the explanation and formula sections below, or try a related calculator.</p></div>`;

  const wireUp = (el, slug) => {
    const map = mapping[slug] || mapping[slug.replace(/-calculator/,'-calculator')];
    if(!map) {
      if(slug.includes('emi')||slug.includes('loan')) {
        el.innerHTML = mapping['loan-emi-calculator'].render();
        mapping['loan-emi-calculator'].bind(el);
        return;
      }
      if(slug.includes('rd')||slug.includes('recurring')) {
        el.innerHTML = fallbackRender(slug);
        return;
      }
      if(slug.includes('cgpa')||slug.includes('gpa')) {
        el.innerHTML = mapping['gpa-calculator'].render();
        mapping['gpa-calculator'].bind(el);
        return;
      }
      if(slug.includes('calorie')||slug.includes('calories')) {
        el.innerHTML = mapping['calories-burned-running-walking'].render();
        mapping['calories-burned-running-walking'].bind(el);
        return;
      }
      console.warn('Missing calculator implementation for', slug);
      el.innerHTML = fallbackRender(slug);
      return;
    }
    try {
      el.innerHTML = map.render();
      if(typeof map.bind === 'function') map.bind(el);
    } catch(e) { 
      console.error('calc error', slug, e);
      el.innerHTML = '<p>Error loading calculator</p>';
    }
  };

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('[id^="calc-"]').forEach(el => {
      const slug = el.id.replace(/^calc-/, '');
      wireUp(el, slug);
    });
  });
})();
